import 'dart:convert';
import 'package:field/data_source/forms/view_form_local_data_source.dart';
import 'package:field/injection_container.dart' as di;
import 'package:field/utils/extensions.dart';
import 'package:field/utils/html_interceptor.dart';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:flutter_inappwebview/flutter_inappwebview.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mocktail/mocktail.dart';
import '../bloc/mock_method_channel.dart';
import '../fixtures/appconfig_test_data.dart';
import '../fixtures/fixture_reader.dart';

class MockInAppWebViewController extends Mock implements InAppWebViewController {}
class MockBuildContext extends Mock implements BuildContext {}
class MockViewFormLocalDataSource extends Mock implements ViewFormLocalDataSource {}

void main() {
  TestWidgetsFlutterBinding.ensureInitialized();
  MockMethodChannel().setNotificationMethodChannel();
  MockMethodChannel().setUpGetApplicationDocumentsDirectory();
  late HTMLInterceptor htmlInterceptor;
  late MockInAppWebViewController mockWebViewController;
  late MockBuildContext context;
  late MockViewFormLocalDataSource mockViewFormLocalDataSource;

  setUp(() {
    context = MockBuildContext();
    htmlInterceptor = HTMLInterceptor(context, callbackJSPEvent, {});
    mockWebViewController = MockInAppWebViewController();
    mockViewFormLocalDataSource = MockViewFormLocalDataSource();
    AppConfigTestData().setupAppConfigTestData();
  });

  test('handleJSPCommand', () async {
    when(() => mockWebViewController.evaluateJavascript(source: any(named: "source"))).thenAnswer((invocation) async => Future.value(jsonDecode(fixture("language.json"))));
    await htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22lan%22:%22en_GB%22,%22ver%22:1694175024973%7D", "js-frame:");

    verify(() => mockWebViewController.evaluateJavascript(source: any(named: "source"))).called(1);

    ///attachmentAndAssociationColumnHeadersListJson
    Map<String, dynamic> paramMap = {};
    paramMap["projectId"] = "1233213";
    paramMap["formId"] = "234123";
    paramMap["msgId"] = "324123";
    paramMap["requestedEntityType"] = "views";

    when(() => mockViewFormLocalDataSource.getOfflineFormMessageAttachmentAndAssociationColumnHeadersListJson(any())).thenAnswer((_) async => Future.value(fixture("attachmentAndAssociationColumnHeadersListJson.json")));
    await htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22url%22:%22/adoddle/configcontroller%22,%22data%22:%7B%22action_id%22:1722,%22listingType%22:77,%22type%22:%22files%22%7D%7D", "js-frame:");

    var res = await mockViewFormLocalDataSource.getOfflineFormMessageAttachmentAndAssociationColumnHeadersListJson(paramMap);
    expect(!res.isNullOrEmpty(), true);

    ///getFieldEnabledProjects
    Map<String, dynamic> getFieldEnabledProjects = {};
    paramMap["projectId"] = "2130192";
    paramMap["formId"] = "11694891";
    paramMap["msgId"] = "12419376";
    when(() => mockViewFormLocalDataSource.getOfflineProjectListJson(any())).thenReturn(fixture("getfieldenabledprojects.json"));
    htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22url%22:%22/adoddlenavigatorapi/workspace/fieldEnabledSelectedProjects%22,%22data%22:%7B%22isFromFilter%22:true,%22projectId%22:%222130192%22,%22action_id%22:222%7D%7D", "js-frame:");

    var resp = mockViewFormLocalDataSource.getOfflineProjectListJson(getFieldEnabledProjects);
    expect(!resp.isNullOrEmpty(), true);

    ///getLocations
    Map<String, dynamic> getLocations = {};
    paramMap["projectId"] = "2130192";
    paramMap["folderId"] = "0";

    when(() => mockViewFormLocalDataSource.getOfflineLocationListJson(any())).thenReturn(fixture("getLocations.json"));
    htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22url%22:%22/commonapi/pflocationservice/getLocationTree%22,%22data%22:%7B%22action_id%22:223,%22projectId%22:%222130192%22,%22folderId%22:0,%22isWorkspace%22:1,%22appType%22:2%7D,%22_dcId%22:null%7D", "js-frame:");

    var getlocations = mockViewFormLocalDataSource.getOfflineLocationListJson(getLocations);
    expect(!getlocations.isNullOrEmpty(), true);

    ///getLocationsTree
    Map<String, dynamic> getLocationsTree = {};
    paramMap["projectId"] = "2130192";
    paramMap["folderId"] = "115096348";

    when(() => mockViewFormLocalDataSource.getOfflineLocationListJson(any())).thenReturn(fixture("getLocationsTree.json"));
    htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22url%22:%22/commonapi/pflocationservice/getLocationTree%22,%22data%22:%7B%22action_id%22:224,%22projectId%22:%222130192%22,%22folderId%22:%22115096348%22,%22isWorkspace%22:0,%22appType%22:2%7D%7D", "js-frame:");

    var getLocationstree = mockViewFormLocalDataSource.getOfflineLocationListJson(getLocationsTree);
    expect(!getLocationstree.isNullOrEmpty(), true);

    ///getAssociatedLocationTreeBySearch
    Map<String, dynamic> getAssociatedLocationTreeBySearch = {};
    paramMap["action_id"] = 1002;
    paramMap["folderTypeId"] = 1;
    paramMap["searchValue"] = "b";
    paramMap["selectedProjectIds"] = "2130192";
    String data = '{"totalDocs":1,"recordBatchSize":0,"data":[{"id":"115096357#2130192","value":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Basement","dataCenterId":0,"isSelected":false,"imgId":-1,"isActive":true}],"isSortRequired":true,"generateURI":true}';
    when(() => mockViewFormLocalDataSource.getFieldAssociateSearchLocationList(any())).thenReturn(data);
    htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22url%22:%22/adoddle/getPopupData%22,%22data%22:%7B%22action_id%22:1002,%22searchValue%22:%22b%22,%22folderTypeId%22:1,%22selectedProjectIds%22:%222130192%22%7D%7D", "js-frame:");

    var getFieldAssociateSearchLocationList = mockViewFormLocalDataSource.getFieldAssociateSearchLocationList(getAssociatedLocationTreeBySearch);
    expect(!getFieldAssociateSearchLocationList.isNullOrEmpty(), true);

    ///getSelectedAssociatedLocationTreeBySearch
    Map<String, dynamic> getSelectedAssociatedLocationTreeBySearch = {};
    paramMap["action_id"] = 221;
    paramMap["projectId"] = "2130192";
    paramMap["folder_id" ] = "115096348";
    paramMap["folderTypeId"] = 1;
    paramMap["selectedProjectIds"] = "2130192";
    paramMap["isfromfieldfolder"] = true;

    String response = '[{"isMarkOffline":false,"canRemoveOffline":false,"isUserAdminforProj":false,"bimEnabled":false,"isFavorite":true,"canAssignApps":false,"isAdminAccess":false,"dcId":null,"ownerOrgId":3,"projectsubscriptiontypeid":0,"projectID":"2130192","projectName":"Site Quality Demo","projectAdmins":"","privilege":",4,5,54,55,56,58,59,63,66,71,72,73,76,86,88,90,91,92,93,94,95,96,97,98,101,103,106,113,123,127,132,133,134,136,138,139,145,146,147,148,149,150,151,154,160,162,170,174,181,9,10,13,14,15,16,17,18,20,21,22,25,28,32,34,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,60,61,62,67,69,70,74,77,78,81,82,83,84,99,100,102,109,110,111,112,114,115,116,117,118,119,120,121,122,124,125,126,129,130,135,137,143,144,145,155,156,157,159,161,163,166,167,168,172,173,175,179,","projectLogoPath":null,"logoUpdateDateTime":null,"iProjectId":0,"parentId":-1,"isWorkspace":1,"projectBaseUrl":"","projectBaseUrlForCollab":"","canManageWorkspaceRoles":false,"canManageWorkspaceFormStatus":false,"isFromExchange":false,"space_type_id":"1","isTemplate":false,"isCloned":false,"activeFilesCount":0,"formsCount":0,"statusId":0,"users":0,"fetchRuleId":0,"canManageWorkspaceDocStatus":false,"canCreateAutoFetchRule":false,"canManagePurposeOfIssue":false,"canManageMailBox":false,"editWorkspaceFormSettings":false,"canManageDistributionGroup":false,"defaultpermissiontypeid":0,"checkoutPref":false,"restrictDownloadOnCheckout":false,"canManageAppSetting":false,"isUseAccess":false,"canManageWorkflowRules":false,"canAccessAuditInformation":true,"countryId":0,"generateURI":true,"childfolderTreeVOList":[{"permission_value":0,"isActive":1,"parentFolderId":110997340,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":true,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":true,"folder_title":"01 Vijay_Test","baseFilePath":"Site Quality Demo\\01 Vijay_Test","folderPath":"Site Quality Demo\\01 Vijay_Test","folderId":"115096348","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[{"permission_value":0,"isActive":1,"parentFolderId":115096348,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":true,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Plan-1","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-1","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-1","folderId":"115096349","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[{"permission_value":0,"isActive":1,"parentFolderId":115096349,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Basement","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Basement","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Basement","folderId":"115096357","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":183682,"siteId":0,"parentLocationId":183679,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13351081","revisionId":"26773045","annotationId":"1fc95526-3610-5163-e2c8-c915a692c3d4","locationCoordinates":"{\"x1\":593.98,\"y1\":669.61,\"x2\":803.92,\"y2\":522.8199999999999}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115096349,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"First-Flour","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\First-Flour","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\First-Flour","folderId":"115096353","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":183680,"siteId":0,"parentLocationId":183679,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13351081","revisionId":"26773045","annotationId":"bf5cd4e7-f128-2442-e711-683b83c35e91","locationCoordinates":"{\"x1\":425,\"y1\":398.22,\"x2\":614.46,\"y2\":154.14999999999998}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115096349,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":true,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Second-Flour","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour","folderId":"115096354","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[{"permission_value":0,"isActive":1,"parentFolderId":115096354,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":true,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"F1","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour\\F1","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour\\F1","folderId":"116458954","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[{"permission_value":0,"isActive":1,"parentFolderId":116458954,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Dining","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour\\F1\\Dining","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour\\F1\\Dining","folderId":"116458969","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":185682,"siteId":0,"parentLocationId":185678,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13673482","revisionId":"27225588","annotationId":"61dd8b1b-a63e-73a1-196c-37767b47cad9","locationCoordinates":"{\"x1\":502,\"y1\":654.85,\"x2\":632.77,\"y2\":475.03999999999996}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":116458954,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Family Room","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour\\F1\\Family Room","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour\\F1\\Family Room","folderId":"116458957","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":185680,"siteId":0,"parentLocationId":185678,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13673482","revisionId":"27225588","annotationId":"ca27873d-84d4-b190-dff8-541807a0c195","locationCoordinates":"{\"x1\":449.69,\"y1\":1021,\"x2\":600.08,\"y2\":815.04}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":116458954,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Kitchen","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour\\F1\\Kitchen","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-1\\Second-Flour\\F1\\Kitchen","folderId":"116458959","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":185681,"siteId":0,"parentLocationId":185678,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13673482","revisionId":"27225588","annotationId":"d6a55c91-8cb4-6fe2-e2e7-0062bd99b516","locationCoordinates":"{\"x1\":251.54,\"y1\":647.04,\"x2\":399.38,\"y2\":531.88}","statusCountList":[],"generateURI":true}}],"pfLocationTreeDetail":{"locationId":185678,"siteId":0,"parentLocationId":183681,"pageNumber":0,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13673482","revisionId":"27225588","annotationId":"","locationCoordinates":null,"statusCountList":[],"generateURI":true}}],"pfLocationTreeDetail":{"locationId":183681,"siteId":0,"parentLocationId":183679,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13351081","revisionId":"26773045","annotationId":"b4adbca7-cfa4-dab0-0040-a2a35e8a4277","locationCoordinates":"{\"x1\":759.54,\"y1\":442.6,\"x2\":1107.73,\"y2\":118.30999999999995}","statusCountList":[],"generateURI":true}}],"pfLocationTreeDetail":{"locationId":183679,"siteId":0,"parentLocationId":183678,"pageNumber":0,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13351081","revisionId":"26773045","annotationId":"","locationCoordinates":null,"statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115096348,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":true,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Plan-2","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-2","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-2","folderId":"115168011","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[{"permission_value":0,"isActive":1,"parentFolderId":115168011,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Room-1","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-2\\Room-1","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-2\\Room-1","folderId":"115168015","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":183763,"siteId":0,"parentLocationId":183762,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13370182","revisionId":"26806055","annotationId":"a3a5ab9f-0561-290e-d00a-e9e1da8c875c","locationCoordinates":"{\"x1\":40.16,\"y1\":761.48,\"x2\":594.38,\"y2\":414.49}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115168011,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Room-2","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-2\\Room-2","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-2\\Room-2","folderId":"115168018","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":183764,"siteId":0,"parentLocationId":183762,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13370182","revisionId":"26806055","annotationId":"34bc3584-4962-ee32-bc06-049ac0b99bc9","locationCoordinates":"{\"x1\":48.19,\"y1\":369.33,\"x2\":597.5900000000001,\"y2\":73.75}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115168011,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Room-3","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-2\\Room-3","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-2\\Room-3","folderId":"115168019","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":183765,"siteId":0,"parentLocationId":183762,"pageNumber":2,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13370182","revisionId":"26806055","annotationId":"0edf0d72-59f6-3bea-fd03-8d893d973edc","locationCoordinates":"{\"x1\":51.41,\"y1\":750.95,\"x2\":579.92,\"y2\":122.83000000000004}","statusCountList":[],"generateURI":true}}],"pfLocationTreeDetail":{"locationId":183762,"siteId":0,"parentLocationId":183678,"pageNumber":0,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13370182","revisionId":"26806055","annotationId":"","locationCoordinates":null,"statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115096348,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":true,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Plan-3","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-3","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-3","folderId":"115333480","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[{"permission_value":0,"isActive":1,"parentFolderId":115333480,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Loc_1","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-3\\Loc_1","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-3\\Loc_1","folderId":"115333483","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":183883,"siteId":0,"parentLocationId":183882,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13401382","revisionId":"26846988","annotationId":"d28e8c3f-b0f4-d513-497a-c962e72b12f3","locationCoordinates":"{\"x1\":86.91,\"y1\":768.12,\"x2\":593.17,\"y2\":405.27}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115333480,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Loc_2","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-3\\Loc_2","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-3\\Loc_2","folderId":"115333485","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":183884,"siteId":0,"parentLocationId":183882,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13401382","revisionId":"26846988","annotationId":"87523bf7-63ee-2a64-521d-8c197b84b48e","locationCoordinates":"{\"x1\":630.11,\"y1\":770.3,\"x2\":1027.74,\"y2\":398.75}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115333480,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Loc_3","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-3\\Loc_3","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-3\\Loc_3","folderId":"115333487","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":183885,"siteId":0,"parentLocationId":183882,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13401382","revisionId":"26846988","annotationId":"f757d489-3a86-db00-3711-c1c3b831256a","locationCoordinates":"{\"x1\":325.92,\"y1\":337.91,\"x2\":951.69,\"y2\":90.21000000000004}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115333480,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Loc_4","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-3\\Loc_4","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-3\\Loc_4","folderId":"116248321","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":185553,"siteId":0,"parentLocationId":183882,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13401382","revisionId":"26846988","annotationId":"38b3639d-f828-864e-30da-921297dc178d","locationCoordinates":"{\"x1\":35.1,\"y1\":352.84,\"x2\":297.23,\"y2\":109.35000000000002}","statusCountList":[],"generateURI":true}}],"pfLocationTreeDetail":{"locationId":183882,"siteId":0,"parentLocationId":183678,"pageNumber":0,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13401382","revisionId":"26846988","annotationId":"","locationCoordinates":null,"statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":115096348,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":true,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Plan-4","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-4","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-4","folderId":"116251417","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[{"permission_value":0,"isActive":1,"parentFolderId":116251417,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Family Room","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-4\\Family Room","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-4\\Family Room","folderId":"116251424","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":185571,"siteId":0,"parentLocationId":185570,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13649942","revisionId":"27187964","annotationId":"a60b7f2a-2aee-9275-04c1-a268854de8bd","locationCoordinates":"{\"x1\":465.3,\"y1\":1021.97,\"x2\":594.08,\"y2\":822.3399999999999}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":116251417,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Kitchen","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-4\\Kitchen","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-4\\Kitchen","folderId":"116251429","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":185573,"siteId":0,"parentLocationId":185570,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13649942","revisionId":"27187964","annotationId":"955e2ed0-3a14-cd03-c82a-f36545c64dcd","locationCoordinates":"{\"x1\":250.8,\"y1\":642.43,\"x2\":396.46,\"y2\":546.67}","statusCountList":[],"generateURI":true}},{"permission_value":0,"isActive":1,"parentFolderId":116251417,"lastSyncStatus":1,"isPublic":false,"hasSubFolder":false,"isFavourite":false,"isMarkOffline":true,"canRemoveOffline":false,"folder_title":"Salon","baseFilePath":"Site Quality Demo\\01 Vijay_Test\\Plan-4\\Salon","folderPath":"Site Quality Demo\\01 Vijay_Test\\Plan-4\\Salon","folderId":"116251426","projectId":"2130192","folderPublishPrivateRevPref":0,"clonedFolderId":0,"fetchRuleId":0,"includePublicSubFolder":false,"isPFLocationTree":true,"generateURI":true,"childfolderTreeVOList":[],"pfLocationTreeDetail":{"locationId":185572,"siteId":0,"parentLocationId":185570,"pageNumber":1,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13649942","revisionId":"27187964","annotationId":"a47586b7-a519-3baa-bec3-934eac79c2b0","locationCoordinates":"{\"x1\":460.47,\"y1\":814.3,\"x2\":639.16,\"y2\":669.41}","statusCountList":[],"generateURI":true}}],"pfLocationTreeDetail":{"locationId":185570,"siteId":0,"parentLocationId":183678,"pageNumber":0,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"13649942","revisionId":"27187964","annotationId":"","locationCoordinates":null,"statusCountList":[],"generateURI":true}}],"pfLocationTreeDetail":{"locationId":183678,"siteId":25384,"parentLocationId":0,"pageNumber":0,"isSite":false,"isFileUploaded":false,"isCalibrated":false,"docId":"0","revisionId":"0","annotationId":"","locationCoordinates":null,"statusCountList":[],"generateURI":true}}]}]';
    when(() => mockViewFormLocalDataSource.getFieldAssociateSearchLocationSelectTreeList(any())).thenReturn(response);
    htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22url%22:%22/adoddlenavigatorapi/workspace/fieldEnabledSelectedProjects%22,%22data%22:%7B%22folder_id%22:%22115096348%22,%22projectId%22:%222130192%22,%22isfromfieldfolder%22:true,%22folderTypeId%22:1,%22selectedProjectIds%22:%222130192%22,%22action_id%22:221%7D%7D", "js-frame:");

    var getSelectedAssociatedLocationtreeBySearch = mockViewFormLocalDataSource.getFieldAssociateSearchLocationSelectTreeList(getSelectedAssociatedLocationTreeBySearch);
    expect(!getSelectedAssociatedLocationtreeBySearch.isNullOrEmpty(), true);

    ///getDistributionList
    Map<String, dynamic> getDistributionList = {};
    paramMap["action_id"] = 221;
    paramMap["projectId"] = "2130192";
    paramMap["folder_id" ] = "115096348";
    paramMap["folderTypeId"] = 1;
    paramMap["selectedProjectIds"] = "2130192";
    paramMap["isfromfieldfolder"] = true;

    when(() => mockViewFormLocalDataSource.getDistributionList(any())).thenAnswer((invocation) async => Future.value(fixture("getdistributionlist.json")));
    htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22url%22:%22/adoddle/dist%22,%22data%22:%7B%22action_id%22:11,%22projectId%22:%222130192%22,%22rmft%22:%2211104955%22,%22formID%22:%22%22,%22selected_msg_id%22:%22%22%7D%7D", "js-frame:");

    var getdistribution = await mockViewFormLocalDataSource.getDistributionList(getDistributionList);
    expect(!getdistribution.isNullOrEmpty(), true);

    ///viewFormMessageHtmlResponse
    Map<String, dynamic> viewFormMessageHtmlResponse = {};
    paramMap["projectId"] = "2130192";
    paramMap["msgId" ] = "12419376";
    paramMap["formId"] = "11694891";

    when(() => mockViewFormLocalDataSource.getOfflineFormMessageViewHtml(any())).thenAnswer((invocation) async => Future.value(fixture("view_form_message_hrml_response.json")));
    htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22url%22:%22/adoddle/communications%22,%22data%22:%7B%22action_id%22:115,%22currentPageNo%22:1,%22commId%22:%2211694891%22,%22projectId%22:%222130192%22,%22msgId%22:%2212419376%22,%22folderId%22:%22%22,%22formNum%22:%22%22,%22form_type_id%22:%2211099145%22,%22callerApp%22:10,%22viewAlwaysFormAssociation%22:%22%22,%22assocParentProjectId%22:%222130192%22,%22assocParentFormTypeId%22:%220%22%7D%7D", "js-frame:");

    var viewformmessagehtmlresponse = await mockViewFormLocalDataSource.getOfflineFormMessageViewHtml(viewFormMessageHtmlResponse);
    expect(!viewformmessagehtmlresponse.isNullOrEmpty(), true);

    ///getProjectPrivilege
    var projectprivilege = '{"privileges":",4,5,54,55,56,58,59,63,66,71,72,73,76,86,88,90,91,92,93,94,95,96,97,98,101,103,106,113,123,127,132,133,134,136,138,139,145,146,147,148,149,150,151,154,160,162,170,174,181,9,10,13,14,15,16,17,18,20,21,22,25,28,32,34,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,60,61,62,67,69,70,74,77,78,81,82,83,84,99,100,102,109,110,111,112,114,115,116,117,118,119,120,121,122,124,125,126,129,130,135,137,143,144,145,155,156,157,159,161,163,166,167,168,172,173,175,179,"}';
    when(() => mockViewFormLocalDataSource.getOfflineHTML5ProjectPrivilegeListJson(any())).thenAnswer((invocation) async => Future.value(projectprivilege));
    htmlInterceptor.handleJSPCommand(mockWebViewController, "js-frame:%7B%22url%22:%22/adoddle/dashboard%22,%22data%22:%7B%22action_id%22:207,%22projectId%22:%222130192%22%7D%7D", "js-frame:");

    var getprojectprivilege = await mockViewFormLocalDataSource.getOfflineHTML5ProjectPrivilegeListJson({"projectId": "2130192"});
    expect(!getprojectprivilege.isNullOrEmpty(), true);

    ///messageThreadResponse
    var messagethreadresponse = '{"totalDocs":1,"recordBatchSize":25,"listingType":31,"currentPageNo":0,"recordStartFrom":0,"totalListData":0,"editable":false,"isIncludeSubFolder":true,"data":[{"appType":2,"projectId":"2130192","formTypeId":"11099145","formId":"11694891","msgId":"12419376","dcId":1,"originatorId":2017529,"originator":"https://portalqa.asite.com/adoddleprofilefiles/member_photos/photo_2017529_thumbnail.jpg?v=1694416234000#Mayur","originatorDisplayName":"Mayur Raval m., Asite Solutions Ltd","msgCode":"ORI001","msgCreatedDate":"19-Sep-2023#03:37 AKST","parentMsgId":"0","msgOriginatorId":"2017529","msgTypeId":"1","msgTypeCode":"ORI","folderId":"0","msgHasAssocAttach":false,"jsonData":"{\"myFields\":{\"FORM_CUSTOM_FIELDS\":{\"ORI_MSG_Custom_Fields\":{\"DistributionDays\":\"1\",\"Organization\":\"\",\"DefectTyoe\":\"Computer\",\"dueDate\":\"2023-09-20\",\"ExpectedFinishDate\":\"2023-09-20\",\"DefectDescription\":\"\",\"AssignedToUsersGroup\":{\"AssignedToUsers\":{\"AssignedToUser\":\"707447#Vijay Mavadiya (5336), Asite Solutions\"}},\"dueDay\":\"1\",\"Defect_Description\":\"\",\"LocationName\":\"01 Vijay_Test>Plan-2>Room-1\",\"StartDate\":\"2023-09-19\",\"ActualFinishDate\":\"\",\"ExpectedFinishDays\":\"1\",\"taskPhotoGroup\":{\"taskPhoto\":[],\"taskPhotoCam\":[]},\"LastResponder_For_AssignedTo\":\"707447\",\"TaskType\":\"Defect\",\"ORI_FORMTITLE\":\"Ereref\",\"taskPhotoContain\":{\"taskPhotoList\":[]},\"OriginatorId\":\"2017529 | Mayur Raval m., Asite Solutions Ltd # Mayur Raval m., Asite Solutions Ltd\",\"Assigned\":\"Vijay Mavadiya (5336), Asite Solutions\",\"Todays_Date\":\"2023-09-19T12:36:28\",\"CurrStage\":\"1\",\"Recent_Defects\":\"\",\"FormCreationDate\":\"\",\"StartDateDisplay\":\"19-Sep-2023\",\"LastResponder_For_Originator\":\"2017529\",\"PF_Location_Detail\":\"183763|26806055|{\\\"x1\\\":40.16,\\\"y1\\\":761.48,\\\"x2\\\":594.38,\\\"y2\\\":414.49}|1\",\"Username\":\"\",\"isLaunch\":\"\",\"ORI_USERREF\":\"\",\"Location\":\"183763|Room-1|01 Vijay_Test>Plan-2>Room-1\"},\"RES_MSG_Custom_Fields\":{\"Comments\":\"\",\"SHResponse\":\"Yes\",\"ShowHideFlag\":\"Yes\"},\"CREATE_FWD_RES\":{\"Can_Reply\":\"\"},\"DS_AUTONUMBER\":{\"DS_SEQ_LENGTH\":\"\",\"DS_FORMAUTONO_CREATE\":\"\",\"DS_GET_APP_ACTION_DETAILS\":\"\",\"DS_FORMAUTONO_ADD\":\"\"},\"DS_DATASOURCE\":{\"DS_ASI_SITE_GET_RECENT_DEFECTS\":\"\",\"DS_ASI_SITE_getDefectTypesForProjects_pf\":\"\",\"DS_Response_PARAM\":\"#Comments#DS_ALL_FORMSTATUS\",\"DS_ASI_SITE_getAllLocationByProject_PF\":\"\",\"DS_CALL_METHOD\":\"1\",\"DS_CHECK_FORM_PERMISSION_USER\":\"\",\"DS_Get_All_Responses\":\"\",\"DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY\":\"\",\"DS_Holiday_Calender_Param\":\"\",\"DS_ASI_Configurable_Attributes\":\"\"}},\"attachments\":[],\"Asite_System_Data_Read_Only\":{\"_2_Printing_Data\":{\"DS_PRINTEDON\":\"\",\"DS_PRINTEDBY\":\"\"},\"_4_Form_Type_Data\":{\"DS_FORMGROUPCODE\":\"\",\"DS_FORMAUTONO\":\"\",\"DS_FORMNAME\":\"Site V3\"},\"_3_Project_Data\":{\"DS_PROJECTNAME\":\"Site Quality Demo\",\"DS_CLIENT\":\"\"},\"_5_Form_Data\":{\"DS_DATEOFISSUE\":\"\",\"DS_ISDRAFT_RES_MSG\":\"\",\"Status_Data\":{\"DS_APPROVEDON\":\"\",\"DS_CLOSEDUEDATE\":\"\",\"DS_ALL_ACTIVE_FORM_STATUS\":\"\",\"DS_ALL_FORMSTATUS\":\"1001 # Open\",\"DS_APPROVEDBY\":\"\",\"DS_CLOSE_DUE_DATE\":\"\",\"DS_FORMSTATUS\":\"\"},\"DS_DISTRIBUTION\":\"\",\"DS_ISDRAFT\":\"NO\",\"DS_FORMCONTENT\":\"\",\"DS_FORMCONTENT3\":\"\",\"DS_ORIGINATOR\":\"\",\"DS_FORMCONTENT2\":\"\",\"DS_FORMCONTENT1\":\"\",\"DS_CONTROLLERNAME\":\"\",\"DS_MAXORGFORMNO\":\"\",\"DS_ISDRAFT_RES\":\"\",\"DS_SEND_MSG\":\"0|\",\"DS_MAXFORMNO\":\"\",\"DS_FORMAUTONO_PREFIX\":\"\",\"DS_ATTRIBUTES\":\"\",\"DS_CLOSE_DUE_DATE\":\"2023-09-20\",\"DS_ISDRAFT_FWD_MSG\":\"\",\"DS_FORMID\":\"\"},\"_1_User_Data\":{\"DS_WORKINGUSER\":\"Mayur Raval m., Asite Solutions Ltd\",\"DS_WORKINGUSERROLE\":\"\",\"DS_WORKINGUSER_ID\":\"\",\"DS_WORKINGUSER_ALL_ROLES\":\"\"},\"_6_Form_MSG_Data\":{\"DS_MSGCREATOR\":\"\",\"DS_MSGDATE\":\"\",\"DS_MSGID\":\"\",\"DS_MSGRELEASEDATE\":\"\",\"DS_MSGSTATUS\":\"\",\"ORI_MSG_Data\":{\"DS_DOC_ASSOCIATIONS_ORI\":\"\",\"DS_FORM_ASSOCIATIONS_ORI\":\"\",\"DS_ATTACHMENTS_ORI\":\"\"}}},\"Asite_System_Data_Read_Write\":{\"ORI_MSG_Fields\":{\"SP_RES_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_MSGDATE,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER,DS_Get_All_Responses, DS_DOC_ATTACHMENTS_ALL\",\"SP_RES_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_GET_APP_ACTION_DETAILS\",\"SP_ORI_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER, DS_DOC_ATTACHMENTS_ALL\",\"SP_FORM_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\",\"SP_ORI_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ASI_SITE_getAllLocationByProject_PF,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_ASI_SITE_getDefectTypesForProjects_pf, DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY,DS_ASI_SITE_GET_RECENT_DEFECTS,DS_ASI_Configurable_Attributes\"},\"DS_PROJORGANISATIONS\":\"\",\"DS_PROJUSERS_ALL_ROLES\":\"\",\"DS_PROJDISTGROUPS\":\"\",\"DS_AUTODISTRIBUTE\":\"401\",\"DS_PROJUSERS\":\"\",\"DS_PROJORGANISATIONS_ID\":\"\",\"DS_INCOMPLETE_ACTIONS\":\"\",\"Auto_Distribute_Group\":{\"Auto_Distribute_Users\":[{\"DS_ACTIONDUEDATE\":\"1\",\"DS_FORMACTIONS\":\"3#Respond\",\"DS_PROJDISTUSERS\":\"707447\"}]}}}}","userRefCode":"N/A","updatedDateInMS":"1695123460000","formCreationDateInMS":"1695123460000","msgCreatedDateInMS":"1695123460000","duration":"","projectName":"Site Quality Demo","code":"SV3154","title":"Ereref","orgId":5763307,"firstName":"Mayur","lastName":"Raval m.","orgName":"Asite Solutions Ltd","docType":"Apps","formCreationDate":"19-Sep-2023#03:37 AKST","formNum":154,"templateType":2,"instanceGroupId":11071031,"formTypeName":"Site V3","latestDraftId":"0","isEditFormOffline":false,"isDraft":false,"canOrigChangeStatus":false,"canControllerChangeStatus":false,"isStatusChangeRestricted":false,"isCloseOut":false,"allowReopenForm":true,"statusid":1001,"status":"Open","statusText":"Open","formGroupName":"Site V3","commId":"11694891","msgStatusName":"Sent","project_APD_folder_id":"110997340","observationId":119969,"locationId":183763,"msgStatusId":"20","showPrintIcon":1,"statusChangeUserId":0,"flagType":0,"projectStatusId":"5","hasAttachments":false,"hasDocAssocations":false,"hasBimViewAssociations":false,"hasBimListAssociations":false,"hasFormAssocations":false,"hasCommentAssocations":false,"hasOverallStatus":true,"formHasAssocAttach":false,"formPrintEnabled":true,"hasFormAccess":false,"canAccessHistory":false,"sentNames":["Vijay Mavadiya (5336), Asite Solutions"],"responseRequestBy":"20-Sep-2023#23:59 AKST","formUserSet":[],"actions":[],"allActions":[],"sentActions":[]}]}';
    when(() => mockViewFormLocalDataSource.getOfflineFormMessageListJson(projectId: "2130192",formId:"11694891")).thenAnswer((invocation) async => Future.value(messagethreadresponse));
    htmlInterceptor.handleJSPCommand(mockWebViewController,"js-frame:%7B%22url%22:%22/adoddle/communications%22,%22data%22:%7B%22action_id%22:114,%22currentPageNo%22:1,%22commId%22:%2211694891%22,%22projectId%22:%222130192%22,%22msgId%22:%2212419376%22%7D%7D", "js-frame:");

    var messageThreadResponse = await mockViewFormLocalDataSource.getOfflineFormMessageListJson(projectId: "2130192",formId:"11694891");
    expect(!messageThreadResponse.isNullOrEmpty(), true);
  });

}
callbackJSPEvent() {}
