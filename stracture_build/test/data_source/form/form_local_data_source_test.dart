
import 'dart:convert';

import 'package:field/data/dao/form_dao.dart';
import 'package:field/data/dao/form_message_action_dao.dart';
import 'package:field/data/dao/form_message_attachAndAssoc_dao.dart';
import 'package:field/data/dao/form_message_dao.dart';
import 'package:field/data/dao/location_dao.dart';
import 'package:field/data/dao/project_dao.dart';
import 'package:field/data/dao/status_style_dao.dart';
import 'package:field/data/model/form_message_attach_assoc_vo.dart';
import 'package:field/data/model/form_vo.dart';
import 'package:field/data_source/forms/form_local_data_source.dart';
import 'package:field/database/db_manager.dart';
import 'package:field/database/db_service.dart';
import 'package:field/utils/extensions.dart';
import 'package:field/utils/field_enums.dart';
import 'package:field/utils/file_utils.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mocktail/mocktail.dart';
import 'package:field/offline_injection_container.dart' as di;
import '../../bloc/mock_method_channel.dart';
import '../../fixtures/appconfig_test_data.dart';
import '../../fixtures/fixture_reader.dart';

class MockDatabaseManager extends Mock implements DatabaseManager {}
class FileUtilityMock extends Mock implements FileUtility {}
class DBServiceMock extends Mock implements DBService {}

void main() async{
  TestWidgetsFlutterBinding.ensureInitialized();
  await di.init(test: true);
  MockMethodChannel().setUpGetApplicationDocumentsDirectory();
  AppConfigTestData().setupAppConfigTestData();
  MockDatabaseManager mockDatabaseManager = MockDatabaseManager();
  FormLocalDataSource formLocalDataSource = FormLocalDataSource();
  formLocalDataSource.databaseManager = mockDatabaseManager;
  FileUtilityMock? mockFileUtility = FileUtilityMock();
  DBServiceMock? mockDb;

  setUpAll(() {
    mockDb = DBServiceMock();
    di.getIt.unregister<DBService>();
    di.getIt.unregister<FileUtility>();
    di.getIt.registerFactoryParam<DBService, String, void>((filePath, _) => mockDb!);
    di.getIt.registerLazySingleton<FileUtility>(() => mockFileUtility);
  });

  tearDown(() {
    reset(mockDb);
    reset(mockFileUtility);
  });

  tearDownAll(() {
    mockDb = null;
  });


  group("FormLocalDataSource",() {

    test("removeOfflineFormActivityForAction",() async {
      Map<String,dynamic> paramMap = <String,dynamic>{};
      paramMap["projectId"] = "1233213";
      paramMap["formId"] = "234123";
      paramMap["msgId"] = "324123";
      paramMap["actionId"] = "2";

      dynamic res = await formLocalDataSource.removeOfflineFormActivityForAction("", paramMap);
      expect(res, isNull);
    });

    test("removeOfflineFormDistributionAction",() async {
      Map<String,dynamic> paramMap = <String,dynamic>{};
      paramMap["projectId"] = "1233213";
      paramMap["formId"] = "234123";
      paramMap["msgId"] = "324123";
      paramMap["actionId"] = "2";
      paramMap["CreateDateInMS"] = "13465450";

      dynamic res = await formLocalDataSource.removeOfflineFormDistributionAction("", paramMap);
      expect(res, isNull);
    });

    test("updateOfflineFormStatusChangedData",() async {
      Map<String,dynamic> paramMap = <String,dynamic>{};
      paramMap["projectId"] = "1233213";
      paramMap["formId"] = "234123";
      paramMap["msgId"] = "324123";
      paramMap["actionId"] = "2";

      dynamic res = await formLocalDataSource.updateOfflineFormStatusChangedData("", paramMap);
      expect(res, isNull);
    });

    test("getFieldEditDraftAttachAndAssocList",() async {
      String projectId = "1233213";
      String formId = "234123";
      String msgId = "324123";

      String selectQuery = "SELECT frmMsgAttachTbl.*, prjTbl.DcId, IFNULL(frmView.LocationId,0) AS LocationId,"
          " IFNULL(frmView.ObservationId,0) AS ObservationId, IFNULL(frmView.AppBuilderId,'') AS AppBuilderId, "
          "IFNULL(frmView.TemplateType,0) AS TemplateType FROM FormMsgAttachAndAssocListTbl frmMsgAttachTbl "
          "INNER JOIN ProjectDetailTbl prjTbl ON prjTbl.ProjectId=frmMsgAttachTbl.ProjectId "
          "LEFT JOIN FormListTbl frmView ON frmView.ProjectId=frmMsgAttachTbl.AssocProjectId AND frmView.FormId=frmMsgAttachTbl.AssocFormCommId AND frmMsgAttachTbl.AttachmentType IN (2,6)";
      selectQuery = "$selectQuery WHERE frmMsgAttachTbl.ProjectId=1233213";
      selectQuery = "$selectQuery AND frmMsgAttachTbl.FormId=234123";
      if (msgId != "") {
        selectQuery = "$selectQuery AND frmMsgAttachTbl.MsgId=324123";
      }

      when(() => mockDatabaseManager.executeSelectFromTable(FormMessageAttachAndAssocDao.tableName, selectQuery)).thenReturn([{'ProjectId': "2130192", 'FormTypeId': "11105686", 'MsgId': "123", 'AttachRevId': "1690365038319370", 'AssocDocRevisionId': "1690365038319370", 'AttachmentType': "3", 'AttachAssocDetailJson':"{\"fileType\":\"filetype/.jpg.gif\",\"fileName\":\"edison1.jpg\",\"revisionId\":\"1690365038319370\",\"fileSize\":\"260 KB\",\"hasAccess\":false,\"canDownload\":false,\"publisherUserId\":0,\"hasBravaSupport\":false,\"docId\":\"1690365038319370\",\"attachedBy\":\"\",\"attachedDateInTimeStamp\":\"2023-07-26 15:20:17.017\",\"attachedDate\":\"2023-07-26 15:20:17.017\",\"attachedById\":\"1906453\",\"attachedByName\":\"hardik111 Asite\",\"isLink\":false,\"linkType\":\"Static\",\"isHasXref\":false,\"documentTypeId\":0,\"isRevPrivate\":false,\"isAccess\":true,\"isDocActive\":true,\"folderPermissionValue\":0,\"isRevInDistList\":false,\"isPasswordProtected\":false,\"attachmentId\":\"0\",\"type\":\"3\",\"msgId\":123,\"msgCreationDate\":\"2023-07-26 15:20:17.017\",\"projectId\":\"2130192\",\"folderId\":\"0\",\"dcId\":1,\"childProjectId\":0,\"userId\":0,\"resourceId\":0,\"parentMsgId\":123,\"parentMsgCode\":\"ORI001\",\"assocsParentId\":\"0\",\"generateURI\":true,\"hasOnlineViewerSupport\":false,\"downloadImageName\":\"\"}"}]);
      when(() => mockFileUtility.isFileExists(any())).thenAnswer((_) => Future.value(true));     // when(()async => await formLocalDataSource.getOfflineFieldMessagesAttachmentAndAssociationListJson(param)).thenAnswer((_) => Future.value());
      var mMap = await formLocalDataSource.getFieldEditDraftAttachAndAssocList(projectid: projectId,formId: formId,msgId: msgId);
      expect(mMap, isA<Map<String, dynamic>>());
    });

    test("getOfflineFieldMessagesAttachmentAndAssociationListJson",() async {
      Map<String,dynamic> paramMap = {};
      paramMap["projectId"] = "1233213";
      paramMap["formId"] = "234123";
      paramMap["msgId"] = "324123";
      paramMap["requestedEntityType"] = "views";

      var res = await formLocalDataSource.getOfflineFieldMessagesAttachmentAndAssociationListJson(paramMap);
      expect(!res.isNullOrEmpty(), true);
    });

    test("getOfflineFormMessageAttachmentAndAssociationColumnHeadersListJson",() async {
      Map<String,dynamic> paramMap = {};
      paramMap["ListingType"] = "2";
      paramMap["isForSiteTask"] = true;
      String requestData = "{\"projectId\":\"2130192\",\"locationId\":183678,\"coordinates\":\"{}\",\"annotationId\":\"61c6ef9a-19e0-4088-a6ee-b39f831db26e-1690785287551\",\"isFromMapView\":true,\"isCalibrated\":true,\"page_number\":1,\"appTypeId\":2,\"formSelectRadiobutton\":\"1_2130192_11103151\",\"formTypeId\":\"11103151\",\"instanceGroupId\":\"10940318\",\"templateType\":2,\"appBuilderId\":\"ASI-SITE\",\"revisionId\":\"0\",\"offlineFormId\":1690785287567,\"isUploadAttachmentInTemp\":true,\"formCreationDate\":\"2023-07-31 12:04:47\",\"url\":\"file:///data/user/0/com.asite.field/app_flutter/database/HTML5Form/createFormHTML.html\",\"offlineFormDataJson\":\"{\\\"myFields\\\":{\\\"FORM_CUSTOM_FIELDS\\\":{\\\"ORI_MSG_Custom_Fields\\\":{\\\"ORI_FORMTITLE\\\":\\\"Test Offlinr VJ\\\",\\\"ORI_USERREF\\\":\\\"\\\",\\\"DefectTyoe\\\":\\\"Computer\\\",\\\"TaskType\\\":\\\"Defect\\\",\\\"DefectDescription\\\":\\\"\\\",\\\"Location\\\":\\\"183678|01 Vijay_Test|01 Vijay_Test\\\",\\\"LocationName\\\":\\\"01 Vijay_Test\\\",\\\"StartDate\\\":\\\"2023-07-31\\\",\\\"StartDateDisplay\\\":\\\"31-Jul-2023\\\",\\\"ExpectedFinishDate\\\":\\\"\\\",\\\"OriginatorId\\\":\\\"2017529 | Mayur Raval m., Asite Solutions Ltd # Mayur Raval m., Asite Solutions Ltd\\\",\\\"ActualFinishDate\\\":\\\"\\\",\\\"Recent_Defects\\\":\\\"\\\",\\\"AssignedToUsersGroup\\\":{\\\"AssignedToUsers\\\":{\\\"AssignedToUser\\\":\\\"707447#Vijay Mavadiya (5336), Asite Solutions\\\"}},\\\"CurrStage\\\":\\\"1\\\",\\\"PF_Location_Detail\\\":\\\"183678|0|null|0\\\",\\\"Defect_Description\\\":\\\"test description\\\",\\\"Username\\\":\\\"\\\",\\\"Organization\\\":\\\"\\\",\\\"ExpectedFinishDays\\\":\\\"5\\\",\\\"DistributionDays\\\":\\\"0\\\",\\\"LastResponder_For_AssignedTo\\\":\\\"707447\\\",\\\"LastResponder_For_Originator\\\":\\\"2017529\\\",\\\"FormCreationDate\\\":\\\"\\\",\\\"Assigned\\\":\\\"Vijay Mavadiya (5336), Asite Solutions\\\",\\\"attachements\\\":[{\\\"attachedDocs\\\":\\\"\\\"}],\\\"DS_Logo\\\":\\\"images/asite.gif\\\",\\\"isCalibrated\\\":true},\\\"RES_MSG_Custom_Fields\\\":{\\\"Comments\\\":\\\"\\\",\\\"ShowHideFlag\\\":\\\"Yes\\\",\\\"SHResponse\\\":\\\"Yes\\\"},\\\"CREATE_FWD_RES\\\":{\\\"Can_Reply\\\":\\\"\\\"},\\\"DS_AUTONUMBER\\\":{\\\"DS_FORMAUTONO_CREATE\\\":\\\"\\\",\\\"DS_SEQ_LENGTH\\\":\\\"\\\",\\\"DS_FORMAUTONO_ADD\\\":\\\"\\\",\\\"DS_GET_APP_ACTION_DETAILS\\\":\\\"\\\"},\\\"DS_DATASOURCE\\\":{\\\"DS_ASI_SITE_getAllLocationByProject_PF\\\":\\\"\\\",\\\"DS_Response_PARAM\\\":\\\"#Comments#DS_ALL_FORMSTATUS\\\",\\\"DS_Get_All_Responses\\\":\\\"\\\",\\\"DS_ASI_SITE_getDefectTypesForProjects_pf\\\":\\\"\\\",\\\"DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY\\\":\\\"\\\",\\\"DS_Holiday_Calender_Param\\\":\\\"\\\",\\\"DS_CALL_METHOD\\\":\\\"1\\\",\\\"DS_ASI_SITE_GET_RECENT_DEFECTS\\\":\\\"\\\",\\\"DS_CHECK_FORM_PERMISSION_USER\\\":\\\"\\\",\\\"DS_ASI_Configurable_Attributes\\\":\\\"\\\"}},\\\"Asite_System_Data_Read_Only\\\":{\\\"_1_User_Data\\\":{\\\"DS_WORKINGUSER\\\":\\\"Mayur Raval m., Asite Solutions Ltd\\\",\\\"DS_WORKINGUSERROLE\\\":\\\"\\\",\\\"DS_WORKINGUSER_ID\\\":\\\"\\\",\\\"DS_WORKINGUSER_ALL_ROLES\\\":\\\"\\\"},\\\"_2_Printing_Data\\\":{\\\"DS_PRINTEDBY\\\":\\\"\\\",\\\"DS_PRINTEDON\\\":\\\"\\\"},\\\"_3_Project_Data\\\":{\\\"DS_PROJECTNAME\\\":\\\"Site Quality Demo\\\",\\\"DS_CLIENT\\\":\\\"\\\"},\\\"_4_Form_Type_Data\\\":{\\\"DS_FORMNAME\\\":\\\"Site Tasks\\\",\\\"DS_FORMGROUPCODE\\\":\\\"SITE\\\",\\\"DS_FORMAUTONO\\\":\\\"\\\"},\\\"_5_Form_Data\\\":{\\\"DS_FORMID\\\":\\\"\\\",\\\"DS_ORIGINATOR\\\":\\\"\\\",\\\"DS_DATEOFISSUE\\\":\\\"\\\",\\\"DS_DISTRIBUTION\\\":\\\"\\\",\\\"DS_CONTROLLERNAME\\\":\\\"\\\",\\\"DS_ATTRIBUTES\\\":\\\"\\\",\\\"DS_MAXFORMNO\\\":\\\"\\\",\\\"DS_MAXORGFORMNO\\\":\\\"\\\",\\\"DS_ISDRAFT\\\":\\\"NO\\\",\\\"DS_ISDRAFT_RES\\\":\\\"\\\",\\\"DS_FORMAUTONO_PREFIX\\\":\\\"\\\",\\\"DS_FORMCONTENT\\\":\\\"\\\",\\\"DS_FORMCONTENT1\\\":\\\"\\\",\\\"DS_FORMCONTENT2\\\":\\\"\\\",\\\"DS_FORMCONTENT3\\\":\\\"\\\",\\\"DS_ISDRAFT_RES_MSG\\\":\\\"NO\\\",\\\"DS_ISDRAFT_FWD_MSG\\\":\\\"NO\\\",\\\"Status_Data\\\":{\\\"DS_FORMSTATUS\\\":\\\"\\\",\\\"DS_CLOSEDUEDATE\\\":\\\"\\\",\\\"DS_APPROVEDBY\\\":\\\"\\\",\\\"DS_APPROVEDON\\\":\\\"\\\",\\\"DS_CLOSE_DUE_DATE\\\":\\\"\\\",\\\"DS_ALL_FORMSTATUS\\\":\\\"1001 # Open\\\",\\\"DS_ALL_ACTIVE_FORM_STATUS\\\":\\\"\\\"}},\\\"_6_Form_MSG_Data\\\":{\\\"DS_MSGID\\\":\\\"\\\",\\\"DS_MSGCREATOR\\\":\\\"\\\",\\\"DS_MSGDATE\\\":\\\"\\\",\\\"DS_MSGSTATUS\\\":\\\"\\\",\\\"DS_MSGRELEASEDATE\\\":\\\"\\\",\\\"ORI_MSG_Data\\\":{\\\"DS_DOC_ASSOCIATIONS_ORI\\\":\\\"\\\",\\\"DS_FORM_ASSOCIATIONS_ORI\\\":\\\"\\\",\\\"DS_ATTACHMENTS_ORI\\\":\\\"\\\"}}},\\\"Asite_System_Data_Read_Write\\\":{\\\"ORI_MSG_Fields\\\":{\\\"SP_ORI_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ASI_SITE_getAllLocationByProject_PF,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_ASI_SITE_getDefectTypesForProjects_pf, DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY,DS_ASI_SITE_GET_RECENT_DEFECTS,DS_ASI_Configurable_Attributes\\\",\\\"SP_ORI_PRINT_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\\\",\\\"SP_FORM_PRINT_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\\\",\\\"SP_RES_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_GET_APP_ACTION_DETAILS\\\",\\\"SP_RES_PRINT_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_MSGDATE,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER,DS_Get_All_Responses\\\"},\\\"DS_PROJORGANISATIONS\\\":\\\"\\\",\\\"DS_PROJUSERS\\\":\\\"\\\",\\\"DS_PROJDISTGROUPS\\\":\\\"\\\",\\\"DS_AUTODISTRIBUTE\\\":\\\"401\\\",\\\"DS_INCOMPLETE_ACTIONS\\\":\\\"\\\",\\\"DS_PROJORGANISATIONS_ID\\\":\\\"\\\",\\\"DS_PROJUSERS_ALL_ROLES\\\":\\\"\\\",\\\"Auto_Distribute_Group\\\":{\\\"Auto_Distribute_Users\\\":[{\\\"DS_PROJDISTUSERS\\\":\\\"707447\\\",\\\"DS_FORMACTIONS\\\":\\\"3#Respond\\\",\\\"DS_ACTIONDUEDATE\\\":\\\"5\\\"}]}},\\\"attachments\\\":[],\\\"dist_list\\\":\\\"{\\\\\\\"selectedDistGroups\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"selectedDistUsers\\\\\\\":[],\\\\\\\"selectedDistOrgs\\\\\\\":[],\\\\\\\"selectedDistRoles\\\\\\\":[],\\\\\\\"prePopulatedDistGroups\\\\\\\":\\\\\\\"\\\\\\\"}\\\",\\\"respondBy\\\":\\\"\\\",\\\"selectedControllerUserId\\\":\\\"\\\",\\\"create_hidden_list\\\":{\\\"msg_type_id\\\":\\\"1\\\",\\\"msg_type_code\\\":\\\"ORI\\\",\\\"dist_list\\\":\\\"{\\\\\\\"selectedDistGroups\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"selectedDistUsers\\\\\\\":[],\\\\\\\"selectedDistOrgs\\\\\\\":[],\\\\\\\"selectedDistRoles\\\\\\\":[],\\\\\\\"prePopulatedDistGroups\\\\\\\":\\\\\\\"\\\\\\\"}\\\",\\\"formAction\\\":\\\"create\\\",\\\"project_id\\\":\\\"2130192\\\",\\\"offlineProjectId\\\":\\\"2130192\\\",\\\"offlineFormTypeId\\\":\\\"11103151\\\",\\\"assocLocationSelection\\\":\\\"{\\\\\\\"locationId\\\\\\\":183678}\\\",\\\"requestType\\\":\\\"0\\\",\\\"annotationId\\\":\\\"61c6ef9a-19e0-4088-a6ee-b39f831db26e-1690785287551\\\",\\\"coordinates\\\":\\\"{}\\\",\\\"appTypeId\\\":\\\"2\\\"}}}\",\"isDraft\":false,\"offlineFormCreatedDateInMS\":\"1690785341103\",\"assocLocationSelection\":\"{\\\"locationId\\\":183678,\\\"projectId\\\":\\\"2130192\\\",\\\"folderId\\\":\\\"115096348\\\"}\"}";
      when(() => mockFileUtility.readFromFile("./test/fixtures/files/ColumnHeader/2.json")).thenReturn(requestData);
      var res = await formLocalDataSource.getOfflineFormMessageAttachmentAndAssociationColumnHeadersListJson(paramMap);
      expect(!res.isNullOrEmpty(), true);
    });

    test("getOfflineAttachmentAndAssociationListJson", () async {
      Map<String,dynamic> paramMap = {};
      paramMap["projectId"] = "2130192";
      paramMap["formId"] = "11607652";
      paramMap["msgId"] = "123";
      paramMap["requestedEntityType"] = "all";


      String attachmentListQuery = "SELECT frmMsgAttachTbl.*, prjTbl.DcId, IFNULL(frmView.LocationId,0) AS LocationId, IFNULL(frmView.FormId,0) AS IsAvailableOffline,"
          " IFNULL(frmView.ObservationId,0) AS ObservationId, IFNULL(frmView.AppBuilderId,'') AS AppBuilderId, "
          "IFNULL(frmView.TemplateType,0) AS TemplateType FROM FormMsgAttachAndAssocListTbl frmMsgAttachTbl "
          "INNER JOIN ProjectDetailTbl prjTbl ON prjTbl.ProjectId=frmMsgAttachTbl.ProjectId "
          "LEFT JOIN FormListTbl frmView ON frmView.ProjectId=frmMsgAttachTbl.AssocProjectId AND frmView.FormId=frmMsgAttachTbl.AssocFormCommId AND frmMsgAttachTbl.AttachmentType IN (2,6)";

      attachmentListQuery = "$attachmentListQuery WHERE frmMsgAttachTbl.ProjectId=2130192";
      attachmentListQuery = "$attachmentListQuery AND frmMsgAttachTbl.FormId=11607652";
      attachmentListQuery = "$attachmentListQuery AND frmMsgAttachTbl.MsgId=123 \n";

      when(() => mockDatabaseManager.executeSelectFromTable(FormMessageAttachAndAssocDao.tableName, attachmentListQuery)).thenReturn([{'ProjectId': "2130192", 'FormTypeId': "11105686", 'MsgId': "123", 'AttachRevId': "1690365038319370", 'AssocDocRevisionId': "1690365038319370", 'AttachmentType': "3", 'AttachAssocDetailJson':"{\"fileType\":\"filetype/.jpg.gif\",\"fileName\":\"edison1.jpg\",\"revisionId\":\"1690365038319370\",\"fileSize\":\"260 KB\",\"hasAccess\":false,\"canDownload\":false,\"publisherUserId\":0,\"hasBravaSupport\":false,\"docId\":\"1690365038319370\",\"attachedBy\":\"\",\"attachedDateInTimeStamp\":\"2023-07-26 15:20:17.017\",\"attachedDate\":\"2023-07-26 15:20:17.017\",\"attachedById\":\"1906453\",\"attachedByName\":\"hardik111 Asite\",\"isLink\":false,\"linkType\":\"Static\",\"isHasXref\":false,\"documentTypeId\":0,\"isRevPrivate\":false,\"isAccess\":true,\"isDocActive\":true,\"folderPermissionValue\":0,\"isRevInDistList\":false,\"isPasswordProtected\":false,\"attachmentId\":\"0\",\"type\":\"3\",\"msgId\":123,\"msgCreationDate\":\"2023-07-26 15:20:17.017\",\"projectId\":\"2130192\",\"folderId\":\"0\",\"dcId\":1,\"childProjectId\":0,\"userId\":0,\"resourceId\":0,\"parentMsgId\":123,\"parentMsgCode\":\"ORI001\",\"assocsParentId\":\"0\",\"generateURI\":true,\"hasOnlineViewerSupport\":false,\"downloadImageName\":\"\"}"}]);

      var res = await formLocalDataSource.getOfflineAttachmentAndAssociationListJson(paramMap);
      expect(!res.isNullOrEmpty(), true);
    });

    test("getOfflineProjectListJson", () {
      Map<String,dynamic> paramMap = {};
      paramMap["projectId"] = "2130192";
      String selectQuery = "SELECT * FROM\n"
          "ProjectDetailTbl \n"
          "WHERE StatusId <>7\n"
          "AND \n"
          "ProjectId IN (2130192)";
      when(() => mockDatabaseManager.executeSelectFromTable(ProjectDao.tableName, selectQuery)).thenReturn([{"ProjectId": "2130192", "ProjectName": "Site Quality Demo", "DcId": 1, "Privilege": ",4,5,54,55,56,58,59,63,66,71,72,73,76,86,88,90,91,92,93,94,95,96,97,98,101,103,106,113,123,127,132,133,134,136,138,139,145,146,147,148,149,150,151,154,160,162,170,181,,9,10,13,14,15,16,17,18,20,21,22,25,28,30,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,60,61,62,67,69,70,74,75,77,78,79,80,81,82,83,84,99,100,102,109,110,111,112,114,115,116,117,118,119,120,121,122,124,125,126,129,130,135,137,143,144,145,155,156,157,159,161,163,166,167,168,172,173,175,179,", "ProjectAdmins": "", "OwnerOrgId": 3, "StatusId": 5, "ProjectSubscriptionTypeId": 0, "IsFavorite": 1, "BimEnabled": 0, "IsUserAdminForProject": 1, "CanRemoveOffline": 1, "IsMarkOffline": 1, "SyncStatus": 0, "LastSyncTimeStamp": "", "projectSizeInByte": "138641898"}]);

      var res = formLocalDataSource.getOfflineProjectListJson(paramMap);
      expect(!res.isNullOrEmpty(), true);
    });


    test("getFieldAssociateSearchLocationSelectTreeList", () {
      Map<String,dynamic> paramMap = {};
      paramMap["projectId"] = "2130192";
      paramMap["folder_id"]= "62705245";
      String selectQuery = "SELECT * FROM\n"
          "ProjectDetailTbl \n"
          "WHERE StatusId <>7\n"
          "AND \n"
          "ProjectId IN (2130192)";
      when(() => mockDatabaseManager.executeSelectFromTable(ProjectDao.tableName, selectQuery)).thenReturn([{"ProjectId": "2130192", "ProjectName": "Site Quality Demo", "DcId": 1, "Privilege": ",4,5,54,55,56,58,59,63,66,71,72,73,76,86,88,90,91,92,93,94,95,96,97,98,101,103,106,113,123,127,132,133,134,136,138,139,145,146,147,148,149,150,151,154,160,162,170,181,,9,10,13,14,15,16,17,18,20,21,22,25,28,30,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,60,61,62,67,69,70,74,75,77,78,79,80,81,82,83,84,99,100,102,109,110,111,112,114,115,116,117,118,119,120,121,122,124,125,126,129,130,135,137,143,144,145,155,156,157,159,161,163,166,167,168,172,173,175,179,", "ProjectAdmins": "", "OwnerOrgId": 3, "StatusId": 5, "ProjectSubscriptionTypeId": 0, "IsFavorite": 1, "BimEnabled": 0, "IsUserAdminForProject": 1, "CanRemoveOffline": 1, "IsMarkOffline": 1, "SyncStatus": 0, "LastSyncTimeStamp": "", "projectSizeInByte": "138641898"}]);

      String parentFolderIdListQuery = "WITH ParentLocation AS (\n"
      "SELECT ProjectId,LocationId,ParentLocationId,FolderId,0 AS TreeLevel FROM LocationDetailTbl\n"
      "WHERE ProjectId=2130192 AND FolderId IN(62705245)\n"
      "UNION ALL\n"
      "SELECT locTbl.ProjectId,locTbl.LocationId,locTbl.ParentLocationId,locTbl.FolderId,prntLoc.TreeLevel + 1 AS TreeLevel FROM LocationDetailTbl locTbl\n"
      "INNER JOIN ParentLocation prntLoc ON prntLoc.ProjectId=locTbl.ProjectId AND prntLoc.ParentLocationId=locTbl.LocationId\n"
      ")\n"
      "SELECT FolderId FROM ParentLocation ORDER BY TreeLevel DESC";
      when(() => mockDatabaseManager.executeSelectFromTable(LocationDao.tableName, parentFolderIdListQuery)).thenReturn([{"ProjectId": "2116416","FolderId": "112342369","LocationId": 44053,"LocationTitle": "1234","ParentFolderId": 0,"ParentLocationId": 0,"PermissionValue": 0,"LocationPath": "!!PIN_ANY_APP_TYPE_20_9\\\\1234","SiteId": 6307,"DocumentId": "0","RevisionId": "0","AnnotationId": "","PageNumber": 0,"IsPublic": 0,"IsFavorite": 0,"IsSite": 1,"IsCalibrated": 0,"IsFileUploaded": 0,"IsActive": 1,"HasSubFolder": 0,"SyncStatus":1,}]);

      String mapOfLocationList = "SELECT locTbl.ProjectId AS projectId, locTbl.FolderId AS folderId,locTbl.LocationId AS locationId, locTbl.LocationTitle AS folder_title, locTbl.IsActive AS isActive, locTbl.LocationPath AS baseFilePath,\n"
          "locTbl.PermissionValue AS permission_value, locTbl.LocationPath AS folderPath, locTbl.IsPublic AS isPublic, locTbl.HasSubFolder AS hasSubFolder, locTbl.IsFavorite AS isFavourite,\n"
          "locTbl.ParentFolderId AS parentFolderId, locTbl.SiteId AS siteId, locTbl.IsSite AS isSite, locTbl.ParentLocationId AS parentLocationId, locTbl.DocumentId AS docId, locTbl.RevisionId AS revisionId,\n"
          "locTbl.IsFileUploaded AS isFileUploaded, locTbl.AnnotationId AS annotationId, locTbl.LocationCoordinate AS locationCoordinates,locTbl.IsCalibrated AS isCalibrated,\n"
          "locTbl.IsMarkOffline AS isMarkOffline, locTbl.CanRemoveOffline AS canRemoveOffline, locTbl.SyncStatus AS lastSyncStatus, locTbl.PageNumber AS pageNumber\n"
          "FROM LocationDetailTbl locTbl";
      mapOfLocationList = "$mapOfLocationList WHERE locTbl.ProjectId=2130192";
      mapOfLocationList = "$mapOfLocationList AND locTbl.ParentLocationId=0";
      mapOfLocationList = "$mapOfLocationList AND locTbl.IsActive=1";
      mapOfLocationList = "$mapOfLocationList ORDER BY locTbl.LocationTitle COLLATE NOCASE ASC";
      when(() => mockDatabaseManager.executeSelectFromTable(LocationDao.tableName, mapOfLocationList)).thenReturn([{"ProjectId": "2116416","FolderId": "112342369" ,"folderId": "112342369","LocationId": 44053,"LocationTitle": "1234","ParentFolderId": 0,"ParentLocationId": 0,"PermissionValue": 0,"LocationPath": "!!PIN_ANY_APP_TYPE_20_9\\\\1234","SiteId": 6307,"DocumentId": "0","RevisionId": "0","AnnotationId": "","PageNumber": 0,"IsPublic": 0,"IsFavorite": 0,"IsSite": 1,"IsCalibrated": 0,"IsFileUploaded": 0,"IsActive": 1,"HasSubFolder": 0,"SyncStatus":1,}]);

      String locationStatusQuery = "SELECT statusTable.StatusId AS statusId, statusTable.StatusName AS statusName, statusTable.FontColor AS fontColor, statusTable.BackgroundColor AS bgColor,";
      locationStatusQuery = "${locationStatusQuery}statusTable.StatusTypeId AS statusTypeId, locationTable.StatusCount AS statusCount FROM ";
      locationStatusQuery = "$locationStatusQuery ${LocationDao.tableName} locationTable INNER JOIN ${StatusStyleListDao.tableName} statusTable";
      locationStatusQuery = "$locationStatusQuery ON locationTable.ProjectId = statusTable.ProjectId AND locationTable.StatusId = statusTable.StatusId";
      locationStatusQuery = "$locationStatusQuery AND locationTable.ProjectId = null";
      locationStatusQuery = "$locationStatusQuery AND locationTable.LocationId = null";

      when(() => mockDatabaseManager.executeSelectFromTable(StatusStyleListDao.tableName, locationStatusQuery)).thenReturn([{"statusId":1001,"statusName":"Open","statusTypeId":0,"statusCount":49,"bgColor":"#de474c","fontColor":"#000000","generateURI":true}]);
      var res = formLocalDataSource.getFieldAssociateSearchLocationSelectTreeList(paramMap);
      expect(!res.isNullOrEmpty(), true);
    });

    test("isPushToServerData",() async{
      String query = "SELECT * FROM (\n"
          "SELECT 1 AS RequestType,ProjectId,FormId,MsgId,UpdatedDateInMS FROM FormMessageListTbl\n"
          "WHERE OfflineRequestData<>''\n"
          "UNION\n"
          "SELECT 2 AS RequestType,ProjectId,FormId,MessageId AS MsgId,CreateDateInMS AS UpdatedDateInMS FROM FormStatusHistoryTbl\n"
          "WHERE JsonData<>''\n"
          "UNION\n"
          "SELECT IIF(actionId=6,4,3) AS RequestType,ProjectId,FormId,MsgId,CreatedDateInMs AS UpdatedDateInMS FROM OfflineActivityTbl\n"
          "WHERE OfflineRequestData<>''\n"
          ")\n"
          "ORDER BY CAST(UpdatedDateInMS AS INTEGER) ASC";

      when(() => mockDatabaseManager.executeSelectFromTable(FormMessageDao.tableName, query)).thenReturn([{"ProjectId":"2130192","FormTypeId":"11103151","FormId":"1691478052496","MsgId":"1691478133747","Originator":"","OriginatorDisplayName":" Mayur Raval m., Asite Solutions Ltd ","MsgCode":"ORI001","MsgCreatedDate":"2023-08-08 12:32:13.013","ParentMsgId":"0","MsgOriginatorId":"2017529","MsgHasAssocAttach":1,"JsonData":"{\"myFields\":{\"FORM_CUSTOM_FIELDS\":{\"ORI_MSG_Custom_Fields\":{\"ORI_FORMTITLE\":\"Edit Form Test\",\"ORI_USERREF\":\"\",\"DefectTyoe\":\"Architectural\",\"TaskType\":\"Damages\",\"DefectDescription\":\"\",\"Location\":\"185572|Salon|01 Vijay_Test>Plan-4>Salon\",\"LocationName\":\"01 Vijay_Test>Plan-4>Salon\",\"StartDate\":\"2023-08-08\",\"StartDateDisplay\":\"08-Aug-2023\",\"ExpectedFinishDate\":\"2023-08-20\",\"OriginatorId\":\"2017529 | Mayur Raval m., Asite Solutions Ltd # Mayur Raval m., Asite Solutions Ltd\",\"ActualFinishDate\":\"\",\"Recent_Defects\":\"\",\"AssignedToUsersGroup\":{\"AssignedToUsers\":{\"AssignedToUser\":\"1161363#Chandresh Patel, Asite Solutions\"}},\"CurrStage\":\"1\",\"PF_Location_Detail\":\"185572|27187964|{\\\"x1\\\":460.47,\\\"y1\\\":814.3,\\\"x2\\\":639.16,\\\"y2\\\":669.41}|1\",\"Defect_Description\":\"T\",\"Username\":\"\",\"Organization\":\"\",\"ExpectedFinishDays\":\"12\",\"DistributionDays\":\"0\",\"LastResponder_For_AssignedTo\":\"1161363\",\"LastResponder_For_Originator\":\"2017529\",\"FormCreationDate\":\"\",\"Assigned\":\"Chandresh Patel, Asite Solutions\",\"attachements\":[{\"attachedDocs\":\"\"}],\"DS_Logo\":\"images/asite.gif\",\"isCalibrated\":true},\"RES_MSG_Custom_Fields\":{\"Comments\":\"\",\"ShowHideFlag\":\"Yes\",\"SHResponse\":\"Yes\"},\"CREATE_FWD_RES\":{\"Can_Reply\":\"\"},\"DS_AUTONUMBER\":{\"DS_FORMAUTONO_CREATE\":\"\",\"DS_SEQ_LENGTH\":\"\",\"DS_FORMAUTONO_ADD\":\"\",\"DS_GET_APP_ACTION_DETAILS\":\"\"},\"DS_DATASOURCE\":{\"DS_ASI_SITE_getAllLocationByProject_PF\":\"\",\"DS_Response_PARAM\":\"#Comments#DS_ALL_FORMSTATUS\",\"DS_Get_All_Responses\":\"\",\"DS_ASI_SITE_getDefectTypesForProjects_pf\":\"\",\"DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY\":\"\",\"DS_Holiday_Calender_Param\":\"\",\"DS_CALL_METHOD\":\"1\",\"DS_ASI_SITE_GET_RECENT_DEFECTS\":\"\",\"DS_CHECK_FORM_PERMISSION_USER\":\"\",\"DS_ASI_Configurable_Attributes\":\"\"}},\"Asite_System_Data_Read_Only\":{\"_1_User_Data\":{\"DS_WORKINGUSER\":\"Mayur Raval m., Asite Solutions Ltd\",\"DS_WORKINGUSERROLE\":\"\",\"DS_WORKINGUSER_ID\":\"\",\"DS_WORKINGUSER_ALL_ROLES\":\"\"},\"_2_Printing_Data\":{\"DS_PRINTEDBY\":\"\",\"DS_PRINTEDON\":\"\"},\"_3_Project_Data\":{\"DS_PROJECTNAME\":\"Site Quality Demo\",\"DS_CLIENT\":\"\"},\"_4_Form_Type_Data\":{\"DS_FORMNAME\":\"Site Tasks\",\"DS_FORMGROUPCODE\":\"SITE\",\"DS_FORMAUTONO\":\"\"},\"_5_Form_Data\":{\"DS_FORMID\":\"\",\"DS_ORIGINATOR\":\"\",\"DS_DATEOFISSUE\":\"\",\"DS_DISTRIBUTION\":\"\",\"DS_CONTROLLERNAME\":\"\",\"DS_ATTRIBUTES\":\"\",\"DS_MAXFORMNO\":\"\",\"DS_MAXORGFORMNO\":\"\",\"DS_ISDRAFT\":\"NO\",\"DS_ISDRAFT_RES\":\"\",\"DS_FORMAUTONO_PREFIX\":\"\",\"DS_FORMCONTENT\":\"\",\"DS_FORMCONTENT1\":\"\",\"DS_FORMCONTENT2\":\"\",\"DS_FORMCONTENT3\":\"\",\"DS_ISDRAFT_RES_MSG\":\"NO\",\"DS_ISDRAFT_FWD_MSG\":\"NO\",\"Status_Data\":{\"DS_FORMSTATUS\":\"\",\"DS_CLOSEDUEDATE\":\"\",\"DS_APPROVEDBY\":\"\",\"DS_APPROVEDON\":\"\",\"DS_CLOSE_DUE_DATE\":\"\",\"DS_ALL_FORMSTATUS\":\"1001 # Open\",\"DS_ALL_ACTIVE_FORM_STATUS\":\"\"}},\"_6_Form_MSG_Data\":{\"DS_MSGID\":\"\",\"DS_MSGCREATOR\":\"\",\"DS_MSGDATE\":\"\",\"DS_MSGSTATUS\":\"\",\"DS_MSGRELEASEDATE\":\"\",\"ORI_MSG_Data\":{\"DS_DOC_ASSOCIATIONS_ORI\":\"\",\"DS_FORM_ASSOCIATIONS_ORI\":\"\",\"DS_ATTACHMENTS_ORI\":\"\"}}},\"Asite_System_Data_Read_Write\":{\"ORI_MSG_Fields\":{\"SP_ORI_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ASI_SITE_getAllLocationByProject_PF,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_ASI_SITE_getDefectTypesForProjects_pf, DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY,DS_ASI_SITE_GET_RECENT_DEFECTS,DS_ASI_Configurable_Attributes\",\"SP_ORI_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\",\"SP_FORM_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\",\"SP_RES_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_GET_APP_ACTION_DETAILS\",\"SP_RES_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_MSGDATE,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER,DS_Get_All_Responses\"},\"DS_PROJORGANISATIONS\":\"\",\"DS_PROJUSERS\":\"\",\"DS_PROJDISTGROUPS\":\"\",\"DS_AUTODISTRIBUTE\":\"401\",\"DS_INCOMPLETE_ACTIONS\":\"\",\"DS_PROJORGANISATIONS_ID\":\"\",\"DS_PROJUSERS_ALL_ROLES\":\"\",\"Auto_Distribute_Group\":{\"Auto_Distribute_Users\":[{\"DS_PROJDISTUSERS\":\"1161363\",\"DS_FORMACTIONS\":\"3#Respond\",\"DS_ACTIONDUEDATE\":\"12\"}]}},\"attachments\":[],\"dist_list\":\"{\\\"selectedDistGroups\\\":\\\"\\\",\\\"selectedDistUsers\\\":[],\\\"selectedDistOrgs\\\":[],\\\"selectedDistRoles\\\":[],\\\"prePopulatedDistGroups\\\":\\\"\\\"}\",\"respondBy\":\"\",\"selectedControllerUserId\":\"\",\"create_hidden_list\":{\"msg_type_id\":\"1\",\"msg_type_code\":\"ORI\",\"dist_list\":\"{\\\"selectedDistGroups\\\":\\\"\\\",\\\"selectedDistUsers\\\":[],\\\"selectedDistOrgs\\\":[],\\\"selectedDistRoles\\\":[],\\\"prePopulatedDistGroups\\\":\\\"\\\"}\",\"formAction\":\"create\",\"project_id\":\"2130192\",\"offlineProjectId\":\"2130192\",\"offlineFormTypeId\":\"11103151\",\"assocLocationSelection\":\"{\\\"locationId\\\":185572}\",\"requestType\":\"0\",\"annotationId\":\"24aa2d64-1cda-42ff-93a3-0eacd381ea64-1691478052484\",\"coordinates\":\"{\\\"x1\\\":527.0890387016723,\\\"y1\\\":703.3783692873515,\\\"x2\\\":537.0890387016723,\\\"y2\\\":713.3783692873515}\",\"attachedDocs_0\":\"CAP6805135748225538611.jpg_2017529\",\"upFile0\":\"/data/user/0/com.asite.field/app_flutter/database/1_2017529/2130192/tempAttachments/CAP6805135748225538611.jpg\",\"appTypeId\":\"2\"},\"attachment_fields\":\"\"}}","UserRefCode":"","UpdatedDateInMS":"1691478133747","FormCreationDateInMS":"1691478133747","MsgCreatedDateInMS":"1691478133747","MsgTypeId":"1","MsgTypeCode":"ORI","MsgStatusId":"20","SentNames":"","SentActions":"","DraftSentActions":"","FixFieldData":"","FolderId":"","LatestDraftId":"","IsDraft":0,"AssocRevIds":"","ResponseRequestBy":"08-Aug-2023","DelFormIds":"","AssocFormIds":"","AssocCommIds":"","FormUserSet":"","FormPermissionsMap":"","CanOrigChangeStatus":0,"CanControllerChangeStatus":0,"IsStatusChangeRestricted":0,"HasOverallStatus":0,"IsCloseOut":0,"AllowReopenForm":0,"OfflineRequestData":"1","IsOfflineCreated":1,"LocationId":185572,"ObservationId":1691478052496,"MsgNum":1,"MsgContent":"T","ActionComplete":0,"ActionCleared":0,"HasAttach":1,"TotalActions":0,"InstanceGroupId":10940318,"AttachFiles":"","HasViewAccess":0,"MsgOriginImage":"","IsForInfoIncomplete":0,"MsgCreatedDateOffline":"","LastModifiedTime":"","LastModifiedTimeInMS":"","CanViewDraftMsg":0,"CanViewOwnorgPrivateForms":0,"IsAutoSavedDraft":0,"MsgStatusName":"","ProjectAPDFolderId":"","ProjectStatusId":"","HasFormAccess":0,"CanAccessHistory":0,"HasDocAssocations":0,"HasBimViewAssociations":0,"HasBimListAssociations":0,"HasFormAssocations":0,"HasCommentAssocations":0}]);
      var res = await formLocalDataSource.isPushToServerData();
      expect(res, true);
    });

    test("getFieldAssociateSearchLocationList", () {
      Map<String,dynamic> paramMap = {};
      paramMap["selectedProjectIds"] = "2130192";
      paramMap["searchValue"] = "test";
      String selectQuery = "SELECT (FolderId||'#'||ProjectId) AS Id, LocationPath AS Value FROM LocationDetailTbl\n"
          "WHERE ProjectId=2130192";
      selectQuery = "$selectQuery AND LocationTitle LIKE ('%test%')";
      selectQuery = "$selectQuery ORDER BY Value COLLATE NOCASE ASC";
      when(() => mockDatabaseManager.executeSelectFromTable(ProjectDao.tableName, selectQuery)).thenReturn([{"Id": "1","Value":"test"}]);
      var res = formLocalDataSource.getFieldAssociateSearchLocationList(paramMap);
      expect(!res.isNullOrEmpty(), true);
    });

    test("getInlineAttachmentServerRequestData", () async {
       var offlineFormDataJson = "{\"myFields\":{\"Asite_System_Data_Read_Write\":{\"ORI_MSG_Fields\":{\"SP_ORI_VIEW\":\"DS_ALL_FORMSTATUS\",\"SP_ORI_VIEW_HTML\":\"DS_ALL_FORMSTATUS\",\"SP_ORI_PRINT_VIEW\":\"DS_ALL_FORMSTATUS\",\"SP_ORI_PRINT_VIEW_HTML\":\"DS_ALL_FORMSTATUS\"}},\"TB_Title\":\"Test\",\"Repeating_Table\":{\"value\":[{\"Attachment_2\":{\"@inline\":\"xdoc_0_9_0_0_my:Attachment_2\",\"content\":\"\",\"OfflineContent\":{\"fileType\":6,\"isThumbnailSupports\":false,\"upFilePath\":\"./test/fixtures/files/test.pdf\"}}},{\"Attachment_3\":{\"@inline\":\"xdoc_0_9_0_0_my:Attachment_3\",\"content\":\"2089700#11105686#1690365017226#1690365017226_xdoc_0_4_6_1_my#1690365017226_xdoc_0_4_6_1_my_1690365038319370#1690365038319370\"}}],\"table_header\":[{}],\"table_footer\":[{}],\"defuaultRowData\":{\"Attachment_2\":\"\"}},\"ORI_FORMTITLE\":\"InLine attachments\",\"DS_ALL_FORMSTATUS\":\"5 # Closed-Approved with Comments\",\"CloseDueDate\":\"\",\"Datepicker_1\":\"2023-08-08T18:30:00.000Z\",\"Repeating_Table_2\":{\"value\":[{}],\"table_header\":[{}],\"table_footer\":[{}],\"defuaultRowData\":{}},\"Textbox_1\":\"\",\"MultiDropdown\":\"\",\"Attachment_5\":\"\",\"reply\":\"\",\"ORI_FORMTITLE_Copy\":\"InLine attachments\",\"TB_Title_Copy\":\"Test\",\"Repeating_Table_Copy\":{\"value\":[{}],\"table_header\":[{}],\"table_footer\":[{}],\"defuaultRowData\":{}},\"Dropdown_4_Copy\":\"Closed-Approved with Comments\",\"CloseDueDate_Copy\":\"\",\"attachments\":[],\"dist_list\":\"{\\\"selectedDistGroups\\\":\\\"\\\",\\\"selectedDistUsers\\\":[],\\\"selectedDistOrgs\\\":[],\\\"selectedDistRoles\\\":[],\\\"prePopulatedDistGroups\\\":\\\"\\\"}\",\"respondBy\":\"25-Aug-2023\",\"selectedControllerUserId\":\"\",\"create_hidden_list\":{\"msgId\":\"123\",\"msg_type_id\":\"1\",\"msg_type_code\":\"ORI\",\"dist_list\":\"{\\\"selectedDistGroups\\\":\\\"\\\",\\\"selectedDistUsers\\\":[],\\\"selectedDistOrgs\\\":[],\\\"selectedDistRoles\\\":[],\\\"prePopulatedDistGroups\\\":\\\"\\\"}\",\"formAction\":\"create\",\"project_id\":\"2116416\",\"offlineProjectId\":\"2116416\",\"offlineFormTypeId\":\"10616643\",\"assocLocationSelection\":\"{\\\"locationId\\\":183895}\",\"requestType\":\"0\",\"annotationId\":\"bc2f9956-c777-479c-9402-8f96e3fe1190-1691572633624\",\"coordinates\":\"{\\\"x1\\\":317.409977351698,\\\"y1\\\":578.1311923255256,\\\"x2\\\":327.409977351698,\\\"y2\\\":588.1311923255256}\",\"respondBy\":\"25-Aug-2023\",\"appTypeId\":\"1\"}}}";
       when(() => mockFileUtility.getFileSizeSync(any())).thenReturn(1000);
       String strAttachQuery = "SELECT AttachmentType,AttachAssocDetailJson,AttachFileName FROM FormMsgAttachAndAssocListTbl";
       strAttachQuery = "$strAttachQuery WHERE ProjectId=2089700";
       strAttachQuery = "$strAttachQuery AND (AttachRevId=1690365038319370 OR AssocDocRevisionId=1690365038319370)";
       when(() => mockDatabaseManager.executeSelectFromTable(FormMessageAttachAndAssocDao.tableName, strAttachQuery)).thenReturn([{'ProjectId': "2130192", 'FormTypeId': "11105686", 'MsgId': "123", 'AttachRevId': "1690365038319370", 'AssocDocRevisionId': "1690365038319370", 'AttachmentType': "3", 'AttachAssocDetailJson':"{\"fileType\":\"filetype/.jpg.gif\",\"fileName\":\"edison1.jpg\",\"revisionId\":\"1690365038319370\",\"fileSize\":\"260 KB\",\"hasAccess\":false,\"canDownload\":false,\"publisherUserId\":0,\"hasBravaSupport\":false,\"docId\":\"1690365038319370\",\"attachedBy\":\"\",\"attachedDateInTimeStamp\":\"2023-07-26 15:20:17.017\",\"attachedDate\":\"2023-07-26 15:20:17.017\",\"attachedById\":\"1906453\",\"attachedByName\":\"hardik111 Asite\",\"isLink\":false,\"linkType\":\"Static\",\"isHasXref\":false,\"documentTypeId\":0,\"isRevPrivate\":false,\"isAccess\":true,\"isDocActive\":true,\"folderPermissionValue\":0,\"isRevInDistList\":false,\"isPasswordProtected\":false,\"attachmentId\":\"0\",\"type\":\"3\",\"msgId\":123,\"msgCreationDate\":\"2023-07-26 15:20:17.017\",\"projectId\":\"2130192\",\"folderId\":\"0\",\"dcId\":1,\"childProjectId\":0,\"userId\":0,\"resourceId\":0,\"parentMsgId\":123,\"parentMsgCode\":\"ORI001\",\"assocsParentId\":\"0\",\"generateURI\":true,\"hasOnlineViewerSupport\":false,\"downloadImageName\":\"\"}"}]);
       String? res = await formLocalDataSource.getInlineAttachmentServerRequestData(offlineFormDataJson,(String strInlineAttDetailsList, String strInlineAttReqParamList, Map strInlineAttUploadPath) {});
       expect(!res.isNullOrEmpty(), true);
    });

    test("getInlineAttachmentRevisionIdList", () {
     // var formMessageJson = fixture('form_message_db.json');
    //  var data = jsonDecode(formMessageJson);
      //var jsonData = {"myFields":{"FORM_CUSTOM_FIELDS":{"ORI_MSG_Custom_Fields":{"DistributionDays":"34","Organization":"","DefectTyoe":"Architectural","ExpectedFinishDate":"2023-09-05","DefectDescription":"","AssignedToUsersGroup":{"AssignedToUsers":{"AssignedToUser":"2017529#Mayur Raval m., Asite Solutions Ltd"}},"Defect_Description":"Test","LocationName":"01 Vijay_Test>Plan-1>Basement","StartDate":"2023-07-19","ActualFinishDate":"","ExpectedFinishDays":"34","DS_Logo":"images/asite.gif","LastResponder_For_AssignedTo":"2017529","TaskType":"Damages","isCalibrated":true,"ORI_FORMTITLE":"Respond Test case","attachements":[{"attachedDocs":""}],"OriginatorId":"707447 | Vijay Mavadiya (5336), Asite Solutions # Vijay Mavadiya (5336), Asite Solutions","Assigned":"Mayur Raval m., Asite Solutions Ltd","Todays_Date":"2023-07-19T06:11:45","CurrStage":"1","Recent_Defects":"","FormCreationDate":"","StartDateDisplay":"19-Jul-2023","LastResponder_For_Originator":"707447","PF_Location_Detail":"183682|26773045|{\"x1\":593.98,\"y1\":669.61,\"x2\":803.92,\"y2\":522.8199999999999}|1","Username":"","ORI_USERREF":"","Location":"183682|Basement|01 Vijay_Test>Plan-1>Basement"},"RES_MSG_Custom_Fields":{"Comments":"","SHResponse":"Yes","ShowHideFlag":"Yes"},"CREATE_FWD_RES":{"Can_Reply":""},"DS_AUTONUMBER":{"DS_SEQ_LENGTH":"","DS_FORMAUTONO_CREATE":"","DS_GET_APP_ACTION_DETAILS":"","DS_FORMAUTONO_ADD":""},"DS_DATASOURCE":{"DS_ASI_SITE_GET_RECENT_DEFECTS":"","DS_ASI_SITE_getDefectTypesForProjects_pf":"","DS_Response_PARAM":"#Comments#DS_ALL_FORMSTATUS","DS_ASI_SITE_getAllLocationByProject_PF":"","DS_CALL_METHOD":"1","DS_CHECK_FORM_PERMISSION_USER":"","DS_Get_All_Responses":"","DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY":"","DS_Holiday_Calender_Param":"","DS_ASI_Configurable_Attributes":""}},"attachments":[],"Asite_System_Data_Read_Only":{"_2_Printing_Data":{"DS_PRINTEDON":"","DS_PRINTEDBY":""},"_4_Form_Type_Data":{"DS_FORMGROUPCODE":"","DS_FORMAUTONO":"","DS_FORMNAME":"Site Tasks"},"_3_Project_Data":{"DS_PROJECTNAME":"Site Quality Demo","DS_CLIENT":""},"_5_Form_Data":{"DS_DATEOFISSUE":"","DS_ISDRAFT_RES_MSG":"","Status_Data":{"DS_APPROVEDON":"","DS_CLOSEDUEDATE":"","DS_ALL_ACTIVE_FORM_STATUS":"","DS_ALL_FORMSTATUS":"1001 # Open","DS_APPROVEDBY":"","DS_CLOSE_DUE_DATE":"","DS_FORMSTATUS":""},"DS_DISTRIBUTION":"","DS_ISDRAFT":"NO","DS_FORMCONTENT":"","DS_FORMCONTENT3":"","DS_ORIGINATOR":"","DS_FORMCONTENT2":"","DS_FORMCONTENT1":"","DS_CONTROLLERNAME":"","DS_MAXORGFORMNO":"","DS_ISDRAFT_RES":"","DS_MAXFORMNO":"","DS_FORMAUTONO_PREFIX":"","DS_ATTRIBUTES":"","DS_CLOSE_DUE_DATE":"2023-09-05","DS_ISDRAFT_FWD_MSG":"NO","DS_FORMID":""},"_1_User_Data":{"DS_WORKINGUSER":"Vijay Mavadiya (5336), Asite Solutions","DS_WORKINGUSERROLE":"","DS_WORKINGUSER_ID":"","DS_WORKINGUSER_ALL_ROLES":""},"_6_Form_MSG_Data":{"DS_MSGCREATOR":"","DS_MSGDATE":"","DS_MSGID":"","DS_MSGRELEASEDATE":"","DS_MSGSTATUS":"","ORI_MSG_Data":{"DS_DOC_ASSOCIATIONS_ORI":"","DS_FORM_ASSOCIATIONS_ORI":"","DS_ATTACHMENTS_ORI":""}}},"Asite_System_Data_Read_Write":{"ORI_MSG_Fields":{"SP_RES_PRINT_VIEW":"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_MSGDATE,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER","SP_RES_VIEW":"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_GET_APP_ACTION_DETAILS","SP_ORI_PRINT_VIEW":"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER","SP_FORM_PRINT_VIEW":"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER","SP_ORI_VIEW":"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ASI_SITE_getAllLocationByProject_PF,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_ASI_SITE_getDefectTypesForProjects_pf, DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY,DS_ASI_SITE_GET_RECENT_DEFECTS,DS_ASI_Configurable_Attributes"},"DS_PROJORGANISATIONS":"","DS_PROJUSERS_ALL_ROLES":"","DS_PROJDISTGROUPS":"","DS_AUTODISTRIBUTE":"401","DS_PROJUSERS":"","DS_PROJORGANISATIONS_ID":"","DS_INCOMPLETE_ACTIONS":"","Auto_Distribute_Group":{"Auto_Distribute_Users":[{"DS_ACTIONDUEDATE":"34","DS_FORMACTIONS":"3#Respond","DS_PROJDISTUSERS":"2017529"}]}},"Attachment":[{"@inline":"xdoc_0_4_6_1_my:Attachment","content":"2130192#11105686#123#1690365017226_xdoc_0_4_6_1_my#1690365017226_xdoc_0_4_6_1_my_1690365038319370#1690365038319370","@caption":"edison1.jpg","OfflineContent":{"fileType":6,"isThumbnailSupports":true,"upFilePath":"./test/fixtures/database/1_808581/2130192/tempAttachments/edison1.jpg"}}],"attachment_fields":"xdoc_0_4_6_1_my:Attachment"}};
      List<String> res = formLocalDataSource.getInlineAttachmentRevisionIdList({"myFields":{"Attachment":[{"@inline":"xdoc_0_4_6_1_my:Attachment","content":"2130192#11105686#123#1690365017226_xdoc_0_4_6_1_my#1690365017226_xdoc_0_4_6_1_my_1690365038319370#1690365038319370","@caption":"edison1.jpg","OfflineContent":{"fileType":6,"isThumbnailSupports":true,"upFilePath":"./test/fixtures/database/1_808581/2130192/tempAttachments/edison1.jpg"}}],"attachment_fields":"xdoc_0_4_6_1_my:Attachment"}});
      expect(res, []);
    });

    test("getFormTypeViewAttributeData", () async {
      var jsonData = fixtureFileContent('files/2130192/FormTypes/11103151/data.json');
      when(() => mockFileUtility.readFromFile("./test/fixtures/files/2130192/FormTypes/11103151/data.json")).thenReturn(jsonData);
      String attributeSetData = await formLocalDataSource.getFormTypeViewAttributeData("2130192","11103151","CA_","");
      expect(attributeSetData.isNotEmpty, true);
    });

    test("getFormTypeViewCustomAttributeSetData", () async {
      var jsonData = fixtureFileContent('files/2130192/FormTypes/11103151/data.json');
      when(() => mockFileUtility.readFromFile("./test/fixtures/files/2130192/FormTypes/11103151/data.json")).thenReturn(jsonData);
      String attributeSetData = await formLocalDataSource.getFormTypeViewCustomAttributeSetData(projectId: "2130192", formTypeId: "11103151");
      expect(attributeSetData.isNotEmpty, true);
    });

    test("getPushToServerRequestData", () async {
      var paramData = {
        "RequestType": EOfflineSyncRequestType.CreateOrRespond.value.toString(),
        "ProjectId": "2130192",
        "FormId": "1690869631580",
        "MsgId": "1690869955199",
        "UpdatedDateInMS": "1690869955199",
      };

      String requestData = "{\"projectId\":\"2130192\",\"locationId\":\"0\",\"observationId\":\"107704\",\"formTypeId\":\"11103151\",\"templateType\":2,\"appTypeId\":2,\"appBuilderId\":\"ASI-SITE\",\"formSelectRadiobutton\":\"1_2130192_11103151\",\"isUploadAttachmentInTemp\":null,\"offlineFormId\":1690869631580,\"isCopySiteTask\":true,\"offlineFormDataJson\":\"{\\\"myFields\\\":{\\\"FORM_CUSTOM_FIELDS\\\":{\\\"ORI_MSG_Custom_Fields\\\":{\\\"ORI_FORMTITLE\\\":\\\"Test Offlinr VJ Attachment\\\",\\\"ORI_USERREF\\\":\\\"\\\",\\\"DefectTyoe\\\":\\\"Computer\\\",\\\"TaskType\\\":\\\"Defect\\\",\\\"DefectDescription\\\":\\\"\\\",\\\"Location\\\":\\\"183678|01 Vijay_Test|01 Vijay_Test\\\",\\\"LocationName\\\":\\\"01 Vijay_Test\\\",\\\"StartDate\\\":\\\"2023-08-01\\\",\\\"StartDateDisplay\\\":\\\"01-Aug-2023\\\",\\\"ExpectedFinishDate\\\":\\\"\\\",\\\"OriginatorId\\\":\\\"2017529 | Mayur Raval m., Asite Solutions Ltd # Mayur Raval m., Asite Solutions Ltd\\\",\\\"ActualFinishDate\\\":\\\"\\\",\\\"Recent_Defects\\\":\\\"\\\",\\\"AssignedToUsersGroup\\\":{\\\"AssignedToUsers\\\":{\\\"AssignedToUser\\\":\\\"707447#Vijay Mavadiya (5336), Asite Solutions\\\"}},\\\"CurrStage\\\":\\\"1\\\",\\\"PF_Location_Detail\\\":\\\"183678|0|null|0\\\",\\\"Defect_Description\\\":\\\"test description\\\",\\\"Username\\\":\\\"\\\",\\\"Organization\\\":\\\"\\\",\\\"ExpectedFinishDays\\\":\\\"5\\\",\\\"DistributionDays\\\":\\\"0\\\",\\\"LastResponder_For_AssignedTo\\\":\\\"707447\\\",\\\"LastResponder_For_Originator\\\":\\\"2017529\\\",\\\"FormCreationDate\\\":\\\"\\\",\\\"Assigned\\\":\\\"Vijay Mavadiya (5336), Asite Solutions\\\",\\\"attachements\\\":[{\\\"attachedDocs\\\":\\\"\\\"}],\\\"DS_Logo\\\":\\\"images/asite.gif\\\",\\\"isCalibrated\\\":false},\\\"RES_MSG_Custom_Fields\\\":{\\\"Comments\\\":\\\"\\\",\\\"ShowHideFlag\\\":\\\"Yes\\\",\\\"SHResponse\\\":\\\"Yes\\\"},\\\"CREATE_FWD_RES\\\":{\\\"Can_Reply\\\":\\\"\\\"},\\\"DS_AUTONUMBER\\\":{\\\"DS_FORMAUTONO_CREATE\\\":\\\"\\\",\\\"DS_SEQ_LENGTH\\\":\\\"\\\",\\\"DS_FORMAUTONO_ADD\\\":\\\"\\\",\\\"DS_GET_APP_ACTION_DETAILS\\\":\\\"\\\"},\\\"DS_DATASOURCE\\\":{\\\"DS_ASI_SITE_getAllLocationByProject_PF\\\":\\\"\\\",\\\"DS_Response_PARAM\\\":\\\"#Comments#DS_ALL_FORMSTATUS\\\",\\\"DS_Get_All_Responses\\\":\\\"\\\",\\\"DS_ASI_SITE_getDefectTypesForProjects_pf\\\":\\\"\\\",\\\"DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY\\\":\\\"\\\",\\\"DS_Holiday_Calender_Param\\\":\\\"\\\",\\\"DS_CALL_METHOD\\\":\\\"1\\\",\\\"DS_ASI_SITE_GET_RECENT_DEFECTS\\\":\\\"\\\",\\\"DS_CHECK_FORM_PERMISSION_USER\\\":\\\"\\\",\\\"DS_ASI_Configurable_Attributes\\\":\\\"\\\"}},\\\"Asite_System_Data_Read_Only\\\":{\\\"_1_User_Data\\\":{\\\"DS_WORKINGUSER\\\":\\\"Mayur Raval m., Asite Solutions Ltd\\\",\\\"DS_WORKINGUSERROLE\\\":\\\"\\\",\\\"DS_WORKINGUSER_ID\\\":\\\"\\\",\\\"DS_WORKINGUSER_ALL_ROLES\\\":\\\"\\\"},\\\"_2_Printing_Data\\\":{\\\"DS_PRINTEDBY\\\":\\\"\\\",\\\"DS_PRINTEDON\\\":\\\"\\\"},\\\"_3_Project_Data\\\":{\\\"DS_PROJECTNAME\\\":\\\"\\\",\\\"DS_CLIENT\\\":\\\"\\\"},\\\"_4_Form_Type_Data\\\":{\\\"DS_FORMNAME\\\":\\\"Site Tasks\\\",\\\"DS_FORMGROUPCODE\\\":\\\"SITE\\\",\\\"DS_FORMAUTONO\\\":\\\"\\\"},\\\"_5_Form_Data\\\":{\\\"DS_FORMID\\\":\\\"\\\",\\\"DS_ORIGINATOR\\\":\\\"\\\",\\\"DS_DATEOFISSUE\\\":\\\"\\\",\\\"DS_DISTRIBUTION\\\":\\\"\\\",\\\"DS_CONTROLLERNAME\\\":\\\"\\\",\\\"DS_ATTRIBUTES\\\":\\\"\\\",\\\"DS_MAXFORMNO\\\":\\\"\\\",\\\"DS_MAXORGFORMNO\\\":\\\"\\\",\\\"DS_ISDRAFT\\\":\\\"NO\\\",\\\"DS_ISDRAFT_RES\\\":\\\"\\\",\\\"DS_FORMAUTONO_PREFIX\\\":\\\"\\\",\\\"DS_FORMCONTENT\\\":\\\"\\\",\\\"DS_FORMCONTENT1\\\":\\\"\\\",\\\"DS_FORMCONTENT2\\\":\\\"\\\",\\\"DS_FORMCONTENT3\\\":\\\"\\\",\\\"DS_ISDRAFT_RES_MSG\\\":\\\"\\\",\\\"DS_ISDRAFT_FWD_MSG\\\":\\\"NO\\\",\\\"Status_Data\\\":{\\\"DS_FORMSTATUS\\\":\\\"\\\",\\\"DS_CLOSEDUEDATE\\\":\\\"\\\",\\\"DS_APPROVEDBY\\\":\\\"\\\",\\\"DS_APPROVEDON\\\":\\\"\\\",\\\"DS_CLOSE_DUE_DATE\\\":\\\"\\\",\\\"DS_ALL_FORMSTATUS\\\":\\\"1001 # Open\\\",\\\"DS_ALL_ACTIVE_FORM_STATUS\\\":\\\"\\\"}},\\\"_6_Form_MSG_Data\\\":{\\\"DS_MSGID\\\":\\\"\\\",\\\"DS_MSGCREATOR\\\":\\\"\\\",\\\"DS_MSGDATE\\\":\\\"\\\",\\\"DS_MSGSTATUS\\\":\\\"\\\",\\\"DS_MSGRELEASEDATE\\\":\\\"\\\",\\\"ORI_MSG_Data\\\":{\\\"DS_DOC_ASSOCIATIONS_ORI\\\":\\\"\\\",\\\"DS_FORM_ASSOCIATIONS_ORI\\\":\\\"\\\",\\\"DS_ATTACHMENTS_ORI\\\":\\\"\\\"}}},\\\"Asite_System_Data_Read_Write\\\":{\\\"ORI_MSG_Fields\\\":{\\\"SP_ORI_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ASI_SITE_getAllLocationByProject_PF,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_ASI_SITE_getDefectTypesForProjects_pf, DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY,DS_ASI_SITE_GET_RECENT_DEFECTS,DS_ASI_Configurable_Attributes\\\",\\\"SP_ORI_PRINT_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\\\",\\\"SP_FORM_PRINT_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\\\",\\\"SP_RES_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_GET_APP_ACTION_DETAILS\\\",\\\"SP_RES_PRINT_VIEW\\\":\\\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_MSGDATE,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER,DS_Get_All_Responses\\\"},\\\"DS_PROJORGANISATIONS\\\":\\\"\\\",\\\"DS_PROJUSERS\\\":\\\"\\\",\\\"DS_PROJDISTGROUPS\\\":\\\"\\\",\\\"DS_AUTODISTRIBUTE\\\":\\\"401\\\",\\\"DS_INCOMPLETE_ACTIONS\\\":\\\"\\\",\\\"DS_PROJORGANISATIONS_ID\\\":\\\"\\\",\\\"DS_PROJUSERS_ALL_ROLES\\\":\\\"\\\",\\\"Auto_Distribute_Group\\\":{\\\"Auto_Distribute_Users\\\":[{\\\"DS_PROJDISTUSERS\\\":\\\"707447\\\",\\\"DS_FORMACTIONS\\\":\\\"3#Respond\\\",\\\"DS_ACTIONDUEDATE\\\":\\\"5\\\"}]}},\\\"attachments\\\":[],\\\"dist_list\\\":\\\"{\\\\\\\"selectedDistGroups\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"selectedDistUsers\\\\\\\":[],\\\\\\\"selectedDistOrgs\\\\\\\":[],\\\\\\\"selectedDistRoles\\\\\\\":[],\\\\\\\"prePopulatedDistGroups\\\\\\\":\\\\\\\"\\\\\\\"}\\\",\\\"respondBy\\\":\\\"\\\",\\\"selectedControllerUserId\\\":\\\"\\\",\\\"create_hidden_list\\\":{\\\"msg_type_id\\\":\\\"1\\\",\\\"msg_type_code\\\":\\\"ORI\\\",\\\"dist_list\\\":\\\"{\\\\\\\"selectedDistGroups\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"selectedDistUsers\\\\\\\":[],\\\\\\\"selectedDistOrgs\\\\\\\":[],\\\\\\\"selectedDistRoles\\\\\\\":[],\\\\\\\"prePopulatedDistGroups\\\\\\\":\\\\\\\"\\\\\\\"}\\\",\\\"formAction\\\":\\\"create\\\",\\\"project_id\\\":\\\"2130192\\\",\\\"offlineProjectId\\\":\\\"2130192\\\",\\\"offlineFormTypeId\\\":\\\"11103151\\\",\\\"assocLocationSelection\\\":\\\"{\\\\\\\"locationId\\\\\\\":183678}\\\",\\\"attachedDocs_0\\\":\\\"Image_1690869946283.jpg_2017529\\\",\\\"upFile0\\\":\\\"/data/user/0/com.asite.field/app_flutter/database/1_2017529/2130192/tempAttachments/Image_1690869946283.jpg\\\",\\\"attachedDocs_1\\\":\\\"Image_1690869946713.jpg_2017529\\\",\\\"upFile1\\\":\\\"/data/user/0/com.asite.field/app_flutter/database/1_2017529/2130192/tempAttachments/Image_1690869946713.jpg\\\",\\\"appTypeId\\\":\\\"2\\\"}}}\",\"isDraft\":false,\"offlineFormCreatedDateInMS\":\"1690869955199\",\"assocLocationSelection\":\"{\\\"locationId\\\":183678,\\\"projectId\\\":\\\"2130192\\\",\\\"folderId\\\":\\\"115096348\\\"}\"}";
      String reqFilePath = "./test/fixtures/database/1_808581/2130192/OfflineRequestData/1690869955199.txt";
      when(() => mockFileUtility.readFromFile(reqFilePath))
          .thenReturn(requestData);

      String serverRequestData = await formLocalDataSource.getPushToServerRequestData(paramData);
      expect(serverRequestData.isNotEmpty, true);
      paramData["RequestType"] = EOfflineSyncRequestType.StatusChange.value.toString();
      String statusChangeQuery = "SELECT frmTbl.AppTypeId,frmTbl.LocationId,frmTbl.ObservationId,frmHstrTbl.JsonData AS OfflineRequestData FROM FormStatusHistoryTbl frmHstrTbl\n"
          "INNER JOIN FormListTbl frmTbl ON frmTbl.ProjectId=frmHstrTbl.ProjectId AND frmTbl.FormId=frmHstrTbl.FormId\n"
          "WHERE frmHstrTbl.ProjectId=2130192 AND frmHstrTbl.FormId=1690869631580 AND frmHstrTbl.MessageId=1690869955199 AND frmHstrTbl.CreateDateInMS=1690869955199";
      when(() => mockDatabaseManager.executeSelectFromTable(FormMessageDao.tableName, statusChangeQuery)).thenReturn([{"ProjectId":"2130192","FormTypeId":"11103151","FormId":"1691478052496","MsgId":"1691478133747","Originator":"","OriginatorDisplayName":" Mayur Raval m., Asite Solutions Ltd ","MsgCode":"ORI001","MsgCreatedDate":"2023-08-08 12:32:13.013","ParentMsgId":"0","MsgOriginatorId":"2017529","MsgHasAssocAttach":1,"JsonData":"{\"myFields\":{\"FORM_CUSTOM_FIELDS\":{\"ORI_MSG_Custom_Fields\":{\"ORI_FORMTITLE\":\"Edit Form Test\",\"ORI_USERREF\":\"\",\"DefectTyoe\":\"Architectural\",\"TaskType\":\"Damages\",\"DefectDescription\":\"\",\"Location\":\"185572|Salon|01 Vijay_Test>Plan-4>Salon\",\"LocationName\":\"01 Vijay_Test>Plan-4>Salon\",\"StartDate\":\"2023-08-08\",\"StartDateDisplay\":\"08-Aug-2023\",\"ExpectedFinishDate\":\"2023-08-20\",\"OriginatorId\":\"2017529 | Mayur Raval m., Asite Solutions Ltd # Mayur Raval m., Asite Solutions Ltd\",\"ActualFinishDate\":\"\",\"Recent_Defects\":\"\",\"AssignedToUsersGroup\":{\"AssignedToUsers\":{\"AssignedToUser\":\"1161363#Chandresh Patel, Asite Solutions\"}},\"CurrStage\":\"1\",\"PF_Location_Detail\":\"185572|27187964|{\\\"x1\\\":460.47,\\\"y1\\\":814.3,\\\"x2\\\":639.16,\\\"y2\\\":669.41}|1\",\"Defect_Description\":\"T\",\"Username\":\"\",\"Organization\":\"\",\"ExpectedFinishDays\":\"12\",\"DistributionDays\":\"0\",\"LastResponder_For_AssignedTo\":\"1161363\",\"LastResponder_For_Originator\":\"2017529\",\"FormCreationDate\":\"\",\"Assigned\":\"Chandresh Patel, Asite Solutions\",\"attachements\":[{\"attachedDocs\":\"\"}],\"DS_Logo\":\"images/asite.gif\",\"isCalibrated\":true},\"RES_MSG_Custom_Fields\":{\"Comments\":\"\",\"ShowHideFlag\":\"Yes\",\"SHResponse\":\"Yes\"},\"CREATE_FWD_RES\":{\"Can_Reply\":\"\"},\"DS_AUTONUMBER\":{\"DS_FORMAUTONO_CREATE\":\"\",\"DS_SEQ_LENGTH\":\"\",\"DS_FORMAUTONO_ADD\":\"\",\"DS_GET_APP_ACTION_DETAILS\":\"\"},\"DS_DATASOURCE\":{\"DS_ASI_SITE_getAllLocationByProject_PF\":\"\",\"DS_Response_PARAM\":\"#Comments#DS_ALL_FORMSTATUS\",\"DS_Get_All_Responses\":\"\",\"DS_ASI_SITE_getDefectTypesForProjects_pf\":\"\",\"DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY\":\"\",\"DS_Holiday_Calender_Param\":\"\",\"DS_CALL_METHOD\":\"1\",\"DS_ASI_SITE_GET_RECENT_DEFECTS\":\"\",\"DS_CHECK_FORM_PERMISSION_USER\":\"\",\"DS_ASI_Configurable_Attributes\":\"\"}},\"Asite_System_Data_Read_Only\":{\"_1_User_Data\":{\"DS_WORKINGUSER\":\"Mayur Raval m., Asite Solutions Ltd\",\"DS_WORKINGUSERROLE\":\"\",\"DS_WORKINGUSER_ID\":\"\",\"DS_WORKINGUSER_ALL_ROLES\":\"\"},\"_2_Printing_Data\":{\"DS_PRINTEDBY\":\"\",\"DS_PRINTEDON\":\"\"},\"_3_Project_Data\":{\"DS_PROJECTNAME\":\"Site Quality Demo\",\"DS_CLIENT\":\"\"},\"_4_Form_Type_Data\":{\"DS_FORMNAME\":\"Site Tasks\",\"DS_FORMGROUPCODE\":\"SITE\",\"DS_FORMAUTONO\":\"\"},\"_5_Form_Data\":{\"DS_FORMID\":\"\",\"DS_ORIGINATOR\":\"\",\"DS_DATEOFISSUE\":\"\",\"DS_DISTRIBUTION\":\"\",\"DS_CONTROLLERNAME\":\"\",\"DS_ATTRIBUTES\":\"\",\"DS_MAXFORMNO\":\"\",\"DS_MAXORGFORMNO\":\"\",\"DS_ISDRAFT\":\"NO\",\"DS_ISDRAFT_RES\":\"\",\"DS_FORMAUTONO_PREFIX\":\"\",\"DS_FORMCONTENT\":\"\",\"DS_FORMCONTENT1\":\"\",\"DS_FORMCONTENT2\":\"\",\"DS_FORMCONTENT3\":\"\",\"DS_ISDRAFT_RES_MSG\":\"NO\",\"DS_ISDRAFT_FWD_MSG\":\"NO\",\"Status_Data\":{\"DS_FORMSTATUS\":\"\",\"DS_CLOSEDUEDATE\":\"\",\"DS_APPROVEDBY\":\"\",\"DS_APPROVEDON\":\"\",\"DS_CLOSE_DUE_DATE\":\"\",\"DS_ALL_FORMSTATUS\":\"1001 # Open\",\"DS_ALL_ACTIVE_FORM_STATUS\":\"\"}},\"_6_Form_MSG_Data\":{\"DS_MSGID\":\"\",\"DS_MSGCREATOR\":\"\",\"DS_MSGDATE\":\"\",\"DS_MSGSTATUS\":\"\",\"DS_MSGRELEASEDATE\":\"\",\"ORI_MSG_Data\":{\"DS_DOC_ASSOCIATIONS_ORI\":\"\",\"DS_FORM_ASSOCIATIONS_ORI\":\"\",\"DS_ATTACHMENTS_ORI\":\"\"}}},\"Asite_System_Data_Read_Write\":{\"ORI_MSG_Fields\":{\"SP_ORI_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ASI_SITE_getAllLocationByProject_PF,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_ASI_SITE_getDefectTypesForProjects_pf, DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY,DS_ASI_SITE_GET_RECENT_DEFECTS,DS_ASI_Configurable_Attributes\",\"SP_ORI_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\",\"SP_FORM_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\",\"SP_RES_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_GET_APP_ACTION_DETAILS\",\"SP_RES_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_MSGDATE,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER,DS_Get_All_Responses\"},\"DS_PROJORGANISATIONS\":\"\",\"DS_PROJUSERS\":\"\",\"DS_PROJDISTGROUPS\":\"\",\"DS_AUTODISTRIBUTE\":\"401\",\"DS_INCOMPLETE_ACTIONS\":\"\",\"DS_PROJORGANISATIONS_ID\":\"\",\"DS_PROJUSERS_ALL_ROLES\":\"\",\"Auto_Distribute_Group\":{\"Auto_Distribute_Users\":[{\"DS_PROJDISTUSERS\":\"1161363\",\"DS_FORMACTIONS\":\"3#Respond\",\"DS_ACTIONDUEDATE\":\"12\"}]}},\"attachments\":[],\"dist_list\":\"{\\\"selectedDistGroups\\\":\\\"\\\",\\\"selectedDistUsers\\\":[],\\\"selectedDistOrgs\\\":[],\\\"selectedDistRoles\\\":[],\\\"prePopulatedDistGroups\\\":\\\"\\\"}\",\"respondBy\":\"\",\"selectedControllerUserId\":\"\",\"create_hidden_list\":{\"msg_type_id\":\"1\",\"msg_type_code\":\"ORI\",\"dist_list\":\"{\\\"selectedDistGroups\\\":\\\"\\\",\\\"selectedDistUsers\\\":[],\\\"selectedDistOrgs\\\":[],\\\"selectedDistRoles\\\":[],\\\"prePopulatedDistGroups\\\":\\\"\\\"}\",\"formAction\":\"create\",\"project_id\":\"2130192\",\"offlineProjectId\":\"2130192\",\"offlineFormTypeId\":\"11103151\",\"assocLocationSelection\":\"{\\\"locationId\\\":185572}\",\"requestType\":\"0\",\"annotationId\":\"24aa2d64-1cda-42ff-93a3-0eacd381ea64-1691478052484\",\"coordinates\":\"{\\\"x1\\\":527.0890387016723,\\\"y1\\\":703.3783692873515,\\\"x2\\\":537.0890387016723,\\\"y2\\\":713.3783692873515}\",\"attachedDocs_0\":\"CAP6805135748225538611.jpg_2017529\",\"upFile0\":\"/data/user/0/com.asite.field/app_flutter/database/1_2017529/2130192/tempAttachments/CAP6805135748225538611.jpg\",\"appTypeId\":\"2\"},\"attachment_fields\":\"\"}}","UserRefCode":"","UpdatedDateInMS":"1691478133747","FormCreationDateInMS":"1691478133747","MsgCreatedDateInMS":"1691478133747","MsgTypeId":"1","MsgTypeCode":"ORI","MsgStatusId":"20","SentNames":"","SentActions":"","DraftSentActions":"","FixFieldData":"","FolderId":"","LatestDraftId":"","IsDraft":0,"AssocRevIds":"","ResponseRequestBy":"08-Aug-2023","DelFormIds":"","AssocFormIds":"","AssocCommIds":"","FormUserSet":"","FormPermissionsMap":"","CanOrigChangeStatus":0,"CanControllerChangeStatus":0,"IsStatusChangeRestricted":0,"HasOverallStatus":0,"IsCloseOut":0,"AllowReopenForm":0,"OfflineRequestData":"{\"action_id\":21,\"orig_user_id\":2017529,\"msg_type\":\"ORI\",\"msg_num\":\"001\",\"projectId\":\"2130192\",\"formId\":\"11607175\",\"ori_msg_id\":\"12309325\",\"form_template_type\":2,\"form_type_id\":\"11104955\",\"isUser\":true,\"isFormDetailRequired\":true,\"isStatusChanged\":true,\"comingFrom\":\"FORM\",\"msgId\":\"12309325\",\"actionId\":36,\"form_remarks\":\"Test action\"}","IsOfflineCreated":1,"LocationId":185572,"ObservationId":1691478052496,"MsgNum":1,"MsgContent":"T","ActionComplete":0,"ActionCleared":0,"HasAttach":1,"TotalActions":0,"InstanceGroupId":10940318,"AttachFiles":"","HasViewAccess":0,"MsgOriginImage":"","IsForInfoIncomplete":0,"MsgCreatedDateOffline":"","LastModifiedTime":"","LastModifiedTimeInMS":"","CanViewDraftMsg":0,"CanViewOwnorgPrivateForms":0,"IsAutoSavedDraft":0,"MsgStatusName":"","ProjectAPDFolderId":"","ProjectStatusId":"","HasFormAccess":0,"CanAccessHistory":0,"HasDocAssocations":0,"HasBimViewAssociations":0,"HasBimListAssociations":0,"HasFormAssocations":0,"HasCommentAssocations":0}]);
      String serverRequestData1 = await formLocalDataSource.getPushToServerRequestData(paramData);
      expect(serverRequestData1.isNotEmpty, true);

      paramData["RequestType"] = EOfflineSyncRequestType.DistributeAction.value.toString();
      String distributeActionQuery = "SELECT IFNULL(frmTbl.AppTypeId,'') AS AppTypeId, IFNULL(frmTbl.LocationId,'') AS LocationId, IFNULL(frmTbl.ObservationId,'') AS ObservationId,IFNULL(frmTbl.TemplateType,'') AS TemplateType,offlineActivityTbl.* FROM OfflineActivityTbl offlineActivityTbl\n"
          "LEFT JOIN FormListTbl frmTbl ON OfflineActivityTbl.FormId=frmTbl.FormId\n"
          "WHERE offlineActivityTbl.ProjectId=2130192 AND offlineActivityTbl.FormId=1690869631580  AND offlineActivityTbl.MsgId=1690869955199 AND offlineActivityTbl.CreatedDateInMs=1690869955199";
      when(() => mockDatabaseManager.executeSelectFromTable(FormMessageDao.tableName, distributeActionQuery)).thenReturn([{"ProjectId":"2130192","FormTypeId":"11103151","FormId":"1691478052496","MsgId":"1691478133747","Originator":"","OriginatorDisplayName":" Mayur Raval m., Asite Solutions Ltd ","MsgCode":"ORI001","MsgCreatedDate":"2023-08-08 12:32:13.013","ParentMsgId":"0","MsgOriginatorId":"2017529","MsgHasAssocAttach":1,"JsonData":"{\"myFields\":{\"FORM_CUSTOM_FIELDS\":{\"ORI_MSG_Custom_Fields\":{\"ORI_FORMTITLE\":\"Edit Form Test\",\"ORI_USERREF\":\"\",\"DefectTyoe\":\"Architectural\",\"TaskType\":\"Damages\",\"DefectDescription\":\"\",\"Location\":\"185572|Salon|01 Vijay_Test>Plan-4>Salon\",\"LocationName\":\"01 Vijay_Test>Plan-4>Salon\",\"StartDate\":\"2023-08-08\",\"StartDateDisplay\":\"08-Aug-2023\",\"ExpectedFinishDate\":\"2023-08-20\",\"OriginatorId\":\"2017529 | Mayur Raval m., Asite Solutions Ltd # Mayur Raval m., Asite Solutions Ltd\",\"ActualFinishDate\":\"\",\"Recent_Defects\":\"\",\"AssignedToUsersGroup\":{\"AssignedToUsers\":{\"AssignedToUser\":\"1161363#Chandresh Patel, Asite Solutions\"}},\"CurrStage\":\"1\",\"PF_Location_Detail\":\"185572|27187964|{\\\"x1\\\":460.47,\\\"y1\\\":814.3,\\\"x2\\\":639.16,\\\"y2\\\":669.41}|1\",\"Defect_Description\":\"T\",\"Username\":\"\",\"Organization\":\"\",\"ExpectedFinishDays\":\"12\",\"DistributionDays\":\"0\",\"LastResponder_For_AssignedTo\":\"1161363\",\"LastResponder_For_Originator\":\"2017529\",\"FormCreationDate\":\"\",\"Assigned\":\"Chandresh Patel, Asite Solutions\",\"attachements\":[{\"attachedDocs\":\"\"}],\"DS_Logo\":\"images/asite.gif\",\"isCalibrated\":true},\"RES_MSG_Custom_Fields\":{\"Comments\":\"\",\"ShowHideFlag\":\"Yes\",\"SHResponse\":\"Yes\"},\"CREATE_FWD_RES\":{\"Can_Reply\":\"\"},\"DS_AUTONUMBER\":{\"DS_FORMAUTONO_CREATE\":\"\",\"DS_SEQ_LENGTH\":\"\",\"DS_FORMAUTONO_ADD\":\"\",\"DS_GET_APP_ACTION_DETAILS\":\"\"},\"DS_DATASOURCE\":{\"DS_ASI_SITE_getAllLocationByProject_PF\":\"\",\"DS_Response_PARAM\":\"#Comments#DS_ALL_FORMSTATUS\",\"DS_Get_All_Responses\":\"\",\"DS_ASI_SITE_getDefectTypesForProjects_pf\":\"\",\"DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY\":\"\",\"DS_Holiday_Calender_Param\":\"\",\"DS_CALL_METHOD\":\"1\",\"DS_ASI_SITE_GET_RECENT_DEFECTS\":\"\",\"DS_CHECK_FORM_PERMISSION_USER\":\"\",\"DS_ASI_Configurable_Attributes\":\"\"}},\"Asite_System_Data_Read_Only\":{\"_1_User_Data\":{\"DS_WORKINGUSER\":\"Mayur Raval m., Asite Solutions Ltd\",\"DS_WORKINGUSERROLE\":\"\",\"DS_WORKINGUSER_ID\":\"\",\"DS_WORKINGUSER_ALL_ROLES\":\"\"},\"_2_Printing_Data\":{\"DS_PRINTEDBY\":\"\",\"DS_PRINTEDON\":\"\"},\"_3_Project_Data\":{\"DS_PROJECTNAME\":\"Site Quality Demo\",\"DS_CLIENT\":\"\"},\"_4_Form_Type_Data\":{\"DS_FORMNAME\":\"Site Tasks\",\"DS_FORMGROUPCODE\":\"SITE\",\"DS_FORMAUTONO\":\"\"},\"_5_Form_Data\":{\"DS_FORMID\":\"\",\"DS_ORIGINATOR\":\"\",\"DS_DATEOFISSUE\":\"\",\"DS_DISTRIBUTION\":\"\",\"DS_CONTROLLERNAME\":\"\",\"DS_ATTRIBUTES\":\"\",\"DS_MAXFORMNO\":\"\",\"DS_MAXORGFORMNO\":\"\",\"DS_ISDRAFT\":\"NO\",\"DS_ISDRAFT_RES\":\"\",\"DS_FORMAUTONO_PREFIX\":\"\",\"DS_FORMCONTENT\":\"\",\"DS_FORMCONTENT1\":\"\",\"DS_FORMCONTENT2\":\"\",\"DS_FORMCONTENT3\":\"\",\"DS_ISDRAFT_RES_MSG\":\"NO\",\"DS_ISDRAFT_FWD_MSG\":\"NO\",\"Status_Data\":{\"DS_FORMSTATUS\":\"\",\"DS_CLOSEDUEDATE\":\"\",\"DS_APPROVEDBY\":\"\",\"DS_APPROVEDON\":\"\",\"DS_CLOSE_DUE_DATE\":\"\",\"DS_ALL_FORMSTATUS\":\"1001 # Open\",\"DS_ALL_ACTIVE_FORM_STATUS\":\"\"}},\"_6_Form_MSG_Data\":{\"DS_MSGID\":\"\",\"DS_MSGCREATOR\":\"\",\"DS_MSGDATE\":\"\",\"DS_MSGSTATUS\":\"\",\"DS_MSGRELEASEDATE\":\"\",\"ORI_MSG_Data\":{\"DS_DOC_ASSOCIATIONS_ORI\":\"\",\"DS_FORM_ASSOCIATIONS_ORI\":\"\",\"DS_ATTACHMENTS_ORI\":\"\"}}},\"Asite_System_Data_Read_Write\":{\"ORI_MSG_Fields\":{\"SP_ORI_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ASI_SITE_getAllLocationByProject_PF,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_ASI_SITE_getDefectTypesForProjects_pf, DS_FETCH_HOLIIDAY_CALENDAR_SUMMARY,DS_ASI_SITE_GET_RECENT_DEFECTS,DS_ASI_Configurable_Attributes\",\"SP_ORI_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\",\"SP_FORM_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_Response_PARAM,DS_Get_All_Responses,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER\",\"SP_RES_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_GET_APP_ACTION_DETAILS\",\"SP_RES_PRINT_VIEW\":\"DS_PRINTEDBY,DS_FORMID,DS_ISDRAFT,DS_CLOSE_DUE_DATE,DS_PRINTEDON,ORI_FORMTITLE,ORI_USERREF,DS_ALL_FORMSTATUS,DS_FORMNAME,DS_ALL_ACTIVE_FORM_STATUS,DS_WORKINGUSER_ID,DS_AUTODISTRIBUTE,DS_FORMSTATUS,DS_PROJDISTUSERS,DS_FORMACTIONS,DS_ACTIONDUEDATE,DS_INCOMPLETE_ACTIONS,DS_PROJUSERS_ALL_ROLES,DS_MSGDATE,DS_DATEOFISSUE,DS_CHECK_FORM_PERMISSION_USER,DS_Get_All_Responses\"},\"DS_PROJORGANISATIONS\":\"\",\"DS_PROJUSERS\":\"\",\"DS_PROJDISTGROUPS\":\"\",\"DS_AUTODISTRIBUTE\":\"401\",\"DS_INCOMPLETE_ACTIONS\":\"\",\"DS_PROJORGANISATIONS_ID\":\"\",\"DS_PROJUSERS_ALL_ROLES\":\"\",\"Auto_Distribute_Group\":{\"Auto_Distribute_Users\":[{\"DS_PROJDISTUSERS\":\"1161363\",\"DS_FORMACTIONS\":\"3#Respond\",\"DS_ACTIONDUEDATE\":\"12\"}]}},\"attachments\":[],\"dist_list\":\"{\\\"selectedDistGroups\\\":\\\"\\\",\\\"selectedDistUsers\\\":[],\\\"selectedDistOrgs\\\":[],\\\"selectedDistRoles\\\":[],\\\"prePopulatedDistGroups\\\":\\\"\\\"}\",\"respondBy\":\"\",\"selectedControllerUserId\":\"\",\"create_hidden_list\":{\"msg_type_id\":\"1\",\"msg_type_code\":\"ORI\",\"dist_list\":\"{\\\"selectedDistGroups\\\":\\\"\\\",\\\"selectedDistUsers\\\":[],\\\"selectedDistOrgs\\\":[],\\\"selectedDistRoles\\\":[],\\\"prePopulatedDistGroups\\\":\\\"\\\"}\",\"formAction\":\"create\",\"project_id\":\"2130192\",\"offlineProjectId\":\"2130192\",\"offlineFormTypeId\":\"11103151\",\"assocLocationSelection\":\"{\\\"locationId\\\":185572}\",\"requestType\":\"0\",\"annotationId\":\"24aa2d64-1cda-42ff-93a3-0eacd381ea64-1691478052484\",\"coordinates\":\"{\\\"x1\\\":527.0890387016723,\\\"y1\\\":703.3783692873515,\\\"x2\\\":537.0890387016723,\\\"y2\\\":713.3783692873515}\",\"attachedDocs_0\":\"CAP6805135748225538611.jpg_2017529\",\"upFile0\":\"/data/user/0/com.asite.field/app_flutter/database/1_2017529/2130192/tempAttachments/CAP6805135748225538611.jpg\",\"appTypeId\":\"2\"},\"attachment_fields\":\"\"}}","UserRefCode":"","UpdatedDateInMS":"1691478133747","FormCreationDateInMS":"1691478133747","MsgCreatedDateInMS":"1691478133747","MsgTypeId":"1","MsgTypeCode":"ORI","MsgStatusId":"20","SentNames":"","SentActions":"","DraftSentActions":"","FixFieldData":"","FolderId":"","LatestDraftId":"","IsDraft":0,"AssocRevIds":"","ResponseRequestBy":"08-Aug-2023","DelFormIds":"","AssocFormIds":"","AssocCommIds":"","FormUserSet":"","FormPermissionsMap":"","CanOrigChangeStatus":0,"CanControllerChangeStatus":0,"IsStatusChangeRestricted":0,"HasOverallStatus":0,"IsCloseOut":0,"AllowReopenForm":0,"OfflineRequestData":"{\"action_id\":21,\"orig_user_id\":2017529,\"msg_type\":\"ORI\",\"msg_num\":\"001\",\"projectId\":\"2130192\",\"formId\":\"11607175\",\"ori_msg_id\":\"12309325\",\"form_template_type\":2,\"form_type_id\":\"11104955\",\"isUser\":true,\"isFormDetailRequired\":true,\"isStatusChanged\":true,\"comingFrom\":\"FORM\",\"msgId\":\"12309325\",\"actionId\":36,\"form_remarks\":\"Test action\"}","IsOfflineCreated":1,"LocationId":185572,"ObservationId":1691478052496,"MsgNum":1,"MsgContent":"T","ActionComplete":0,"ActionCleared":0,"HasAttach":1,"TotalActions":0,"InstanceGroupId":10940318,"AttachFiles":"","HasViewAccess":0,"MsgOriginImage":"","IsForInfoIncomplete":0,"MsgCreatedDateOffline":"","LastModifiedTime":"","LastModifiedTimeInMS":"","CanViewDraftMsg":0,"CanViewOwnorgPrivateForms":0,"IsAutoSavedDraft":0,"MsgStatusName":"","ProjectAPDFolderId":"","ProjectStatusId":"","HasFormAccess":0,"CanAccessHistory":0,"HasDocAssocations":0,"HasBimViewAssociations":0,"HasBimListAssociations":0,"HasFormAssocations":0,"HasCommentAssocations":0}]);

      String serverRequestData2 = await formLocalDataSource.getPushToServerRequestData(paramData);
      expect(serverRequestData2.isNotEmpty, true);
    });

    test("getOfflineAttachFileList", () async {
      String strQuery = "SELECT AttachRevId,OfflineUploadFilePath FROM FormMsgAttachAndAssocListTbl";
      strQuery = "$strQuery WHERE ProjectId=2130192 AND FormId=1690869631580 AND MsgId=1690869955199 AND OfflineUploadFilePath <> ''";
      when(() => mockDatabaseManager.executeSelectFromTable(FormMessageAttachAndAssocDao.tableName, strQuery)).thenReturn([{'ProjectId': "2130192", 'FormTypeId': "11105686", 'MsgId': "123", 'AttachRevId': "1690365038319370", 'AssocDocRevisionId': "1690365038319370", 'AttachmentType': "3", 'AttachAssocDetailJson':"{\"fileType\":\"filetype/.jpg.gif\",\"fileName\":\"edison1.jpg\",\"revisionId\":\"1690365038319370\",\"fileSize\":\"260 KB\",\"hasAccess\":false,\"canDownload\":false,\"publisherUserId\":0,\"hasBravaSupport\":false,\"docId\":\"1690365038319370\",\"attachedBy\":\"\",\"attachedDateInTimeStamp\":\"2023-07-26 15:20:17.017\",\"attachedDate\":\"2023-07-26 15:20:17.017\",\"attachedById\":\"1906453\",\"attachedByName\":\"hardik111 Asite\",\"isLink\":false,\"linkType\":\"Static\",\"isHasXref\":false,\"documentTypeId\":0,\"isRevPrivate\":false,\"isAccess\":true,\"isDocActive\":true,\"folderPermissionValue\":0,\"isRevInDistList\":false,\"isPasswordProtected\":false,\"attachmentId\":\"0\",\"type\":\"3\",\"msgId\":123,\"msgCreationDate\":\"2023-07-26 15:20:17.017\",\"projectId\":\"2130192\",\"folderId\":\"0\",\"dcId\":1,\"childProjectId\":0,\"userId\":0,\"resourceId\":0,\"parentMsgId\":123,\"parentMsgCode\":\"ORI001\",\"assocsParentId\":\"0\",\"generateURI\":true,\"hasOnlineViewerSupport\":false,\"downloadImageName\":\"\"}"}]);
      Map<String, String> offlineAttachmentList  = await formLocalDataSource.getOfflineAttachFileList("2130192","1690869631580","1690869955199");
      expect(offlineAttachmentList.isNotEmpty, true);
    });

    test("getOfflineAttachFileList", () async {
      String strQuery = "SELECT AttachRevId,OfflineUploadFilePath FROM FormMsgAttachAndAssocListTbl";
      strQuery = "$strQuery WHERE ProjectId=2130192 AND FormId=1690869631580 AND MsgId=1690869955199 AND OfflineUploadFilePath <> ''";
      when(() => mockDatabaseManager.executeSelectFromTable(FormMessageAttachAndAssocDao.tableName, strQuery)).thenReturn([{'ProjectId': "2130192", 'FormTypeId': "11105686", 'MsgId': "123", 'AttachRevId': "1690365038319370", 'AssocDocRevisionId': "1690365038319370", 'AttachmentType': "3", 'AttachAssocDetailJson':"{\"fileType\":\"filetype/.jpg.gif\",\"fileName\":\"edison1.jpg\",\"revisionId\":\"1690365038319370\",\"fileSize\":\"260 KB\",\"hasAccess\":false,\"canDownload\":false,\"publisherUserId\":0,\"hasBravaSupport\":false,\"docId\":\"1690365038319370\",\"attachedBy\":\"\",\"attachedDateInTimeStamp\":\"2023-07-26 15:20:17.017\",\"attachedDate\":\"2023-07-26 15:20:17.017\",\"attachedById\":\"1906453\",\"attachedByName\":\"hardik111 Asite\",\"isLink\":false,\"linkType\":\"Static\",\"isHasXref\":false,\"documentTypeId\":0,\"isRevPrivate\":false,\"isAccess\":true,\"isDocActive\":true,\"folderPermissionValue\":0,\"isRevInDistList\":false,\"isPasswordProtected\":false,\"attachmentId\":\"0\",\"type\":\"3\",\"msgId\":123,\"msgCreationDate\":\"2023-07-26 15:20:17.017\",\"projectId\":\"2130192\",\"folderId\":\"0\",\"dcId\":1,\"childProjectId\":0,\"userId\":0,\"resourceId\":0,\"parentMsgId\":123,\"parentMsgCode\":\"ORI001\",\"assocsParentId\":\"0\",\"generateURI\":true,\"hasOnlineViewerSupport\":false,\"downloadImageName\":\"\"}"}]);
      Map<String, String> offlineAttachmentList  = await formLocalDataSource.getOfflineAttachFileList("2130192","1690869631580","1690869955199");
      expect(offlineAttachmentList.isNotEmpty, true);
    });

    test("updateOfflineCreatedOrRespondedFormData", () async {
      var paramData = {
        "RequestType": EOfflineSyncRequestType.CreateOrRespond.value.toString(),
        "ProjectId": "2130192",
        "FormId": "1690869631580",
        "MsgId": "1690869955199",
        "UpdatedDateInMS": "1690869955199",
      };
      var postDataNode = {"action_id":19,"projectId":"2130192","dist_list":"{\"nonReviewDraftDistGroupUsers\":[],\"reviewDraftDistGroupUsers\":[],\"selectedDistGroups\":\"\",\"selectedDistUsers\":[{\"email\":false,\"hUserID\":\"707447\",\"fname\":\"Vijay\",\"lname\":\"Mavadiya (5336)\",\"user_type\":1,\"hActionID\":\"6\",\"actionDueDate\":\"28-Jul-2023 17:0:18\"}],\"selectedDistOrgs\":[],\"selectedDistRoles\":[],\"subject\":\"test\"}","save_draft":false,"folderId":"0","msg_num":"001","msg_type":"ORI","rmft":"11104955","msg_type_code":"ORI","msgId":"12309325","formId":"11607175","commitType":2,"originatorId":2017529,"parent_msg_id":"0","statusId":2,"noAccessUsers":"","actionId":"6","appTypeId":2,"formTypeId":11104955,"form_type_id":11104955,"form_template_type":2,"locationId":183764,"observationId":107239,"projectIds":"1111","checkHashing":"false","CreateDateInMS":"1234567890123","offlineMessageId":"3333","isFromAndroidApp":true,"offlineFormCreatedDateInMS":"1234567890123"};
      String jsonDataString = fixture("form_vo_list.json").toString();
      final json = jsonDecode(jsonDataString);
      SiteForm form = SiteForm.fromJson(json[0]);

      List<FormMessageAttachAndAssocVO> formMessageAttachList = [];
      FormMessageAttachAndAssocVO formMessageAttachAndAssoc = FormMessageAttachAndAssocVO.fromJson({"ProjectId":"2089700","FormTypeId":"11129195","FormId":"11639029","MsgId":"12350719","AttachmentType":"3","AttachAssocDetailJson":"","OfflineUploadFilePath":"","AttachDocId":"13693277","AttachRevId":"27247951","AttachFileName":"IMG_0140.jpeg","AssocProjectId":"","AssocDocFolderId":"","AssocDocRevisionId":"","AssocFormCommId":"","AssocCommentMsgId":"","AssocCommentId":"","AssocCommentRevisionId":"","AssocViewModelId":"","AssocViewId":"","AssocListModelId":"","AssocListId":"","AttachSize":"2767"});
      formMessageAttachAndAssoc.setProjectId = 'project123';
      formMessageAttachAndAssoc.setFormTypeId = 'formType456';
      formMessageAttachAndAssoc.setFormId = 'form789';
      formMessageAttachAndAssoc.setLocationId = 'locationXYZ';
      formMessageAttachAndAssoc.setFormMsgId = 'msgId001';
      formMessageAttachAndAssoc.setAttachType = '3';
      formMessageAttachAndAssoc.setAttachAssocDetailJson = '{"data": "detail"}';
      formMessageAttachAndAssoc.setOfflineUploadFilePath = '/path/to/file';
      formMessageAttachAndAssoc.setAttachDocId = 'doc123';
      formMessageAttachAndAssoc.setAttachRevId = 'rev456';
      formMessageAttachAndAssoc.setAttachFileName = 'file.pdf';
      formMessageAttachAndAssoc.setAttachSize = 2048;
      formMessageAttachAndAssoc.setAssocProjectId = 'assocProject789';
      formMessageAttachAndAssoc.setAssocDocFolderId = 'assocFolder123';
      formMessageAttachAndAssoc.setAssocDocRevisionId = 'assocRev456';
      formMessageAttachAndAssoc.setAssocFormCommId = 'assocComm789';
      formMessageAttachAndAssoc.setAssocCommentMsgId = 'assocMsg123';
      formMessageAttachAndAssoc.setAssocCommentId = 'assocCommId456';
      formMessageAttachAndAssoc.setAssocCommentRevisionId = 'assocCommRev789';
      formMessageAttachAndAssoc.setAssocViewModelId = 'assocModel123';
      formMessageAttachAndAssoc.setAssocViewId = 'assocView456';
      formMessageAttachAndAssoc.setAssocListModelId = 'assocListModel789';
      formMessageAttachAndAssoc.setAssocListId = 'assocListId123';
      formMessageAttachList.add(formMessageAttachAndAssoc);

      String attachQuery = "SELECT * FROM FormMsgAttachAndAssocListTbl\n"
          "WHERE ProjectId=2116416 AND FormId=11607175";
      when(() => mockDatabaseManager.executeSelectFromTable(FormMessageAttachAndAssocDao.tableName, attachQuery)).thenReturn([{'AttachFileName':'file.pdf','ProjectId': "2130192", 'FormTypeId': "11105686", 'MsgId': "123", 'AttachRevId': "1690365038319370", 'AssocDocRevisionId': "1690365038319370", 'AttachmentType': "3", 'AttachAssocDetailJson':"{\"fileType\":\"filetype/.jpg.gif\",\"fileName\":\"edison1.jpg\",\"revisionId\":\"1690365038319370\",\"fileSize\":\"260 KB\",\"hasAccess\":false,\"canDownload\":false,\"publisherUserId\":0,\"hasBravaSupport\":false,\"docId\":\"1690365038319370\",\"attachedBy\":\"\",\"attachedDateInTimeStamp\":\"2023-07-26 15:20:17.017\",\"attachedDate\":\"2023-07-26 15:20:17.017\",\"attachedById\":\"1906453\",\"attachedByName\":\"hardik111 Asite\",\"isLink\":false,\"linkType\":\"Static\",\"isHasXref\":false,\"documentTypeId\":0,\"isRevPrivate\":false,\"isAccess\":true,\"isDocActive\":true,\"folderPermissionValue\":0,\"isRevInDistList\":false,\"isPasswordProtected\":false,\"attachmentId\":\"0\",\"type\":\"3\",\"msgId\":123,\"msgCreationDate\":\"2023-07-26 15:20:17.017\",\"projectId\":\"2130192\",\"folderId\":\"0\",\"dcId\":1,\"childProjectId\":0,\"userId\":0,\"resourceId\":0,\"parentMsgId\":123,\"parentMsgCode\":\"ORI001\",\"assocsParentId\":\"0\",\"generateURI\":true,\"hasOnlineViewerSupport\":false,\"downloadImageName\":\"\"}"}]);
      when(() => mockFileUtility.isFileExist(any())).thenReturn(false);
      String delQuery = "DELETE FROM FormListTbl\n"
          "WHERE ProjectId=2116416 AND FormId=11607175";
      when(() => mockDatabaseManager.executeTableRequest(delQuery)).thenReturn([]);
      when(() => mockFileUtility.deleteFileAtPath(any())).thenAnswer((_) => Future.value(null));
      when(() => mockDb!.executeQuery(FormDao().createTableQuery)).thenReturn({});
      when(() => mockDb!.executeQuery(FormMessageDao().createTableQuery)).thenReturn({});
      when(() => mockDb!.executeQuery(FormMessageActionDao().createTableQuery)).thenReturn({});
      when(() => mockDb!.executeQuery(FormMessageAttachAndAssocDao().createTableQuery)).thenReturn({});
      when(() => mockDb!.getPrimaryKeys(FormDao.tableName)).thenReturn([]);
      when(() => mockDb!.getPrimaryKeys(FormMessageDao.tableName)).thenReturn([]);
      when(() => mockDb!.getPrimaryKeys(FormMessageActionDao.tableName)).thenReturn([]);
      when(() => mockDb!.getPrimaryKeys(FormMessageAttachAndAssocDao.tableName)).thenReturn([]);
      when(() => mockDb!.executeBulk(FormDao.tableName, any(), any())).thenAnswer((_) => Future.value(null));
      when(() => mockDb!.executeBulk(FormMessageDao.tableName, any(), any())).thenAnswer((_) => Future.value(null));
      when(() => mockDb!.executeBulk(FormMessageActionDao.tableName, any(), any())).thenAnswer((_) => Future.value(null));
      when(() => mockDb!.executeBulk(FormMessageAttachAndAssocDao.tableName, any(), any())).thenAnswer((_) => Future.value(null));

      bool isSuccess  = await formLocalDataSource.updateOfflineCreatedOrRespondedFormData(
          paramData: paramData,
          requestData: postDataNode,
          frmVO: form,
          frmMsgList: [],
          frmMsgActList: [],
          frmMsgAttachList: formMessageAttachList,
          inlineRevisionIdList: []);
      expect(isSuccess, true);
    });

  });
}